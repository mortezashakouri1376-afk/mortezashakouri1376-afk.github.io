<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پنل مدیریت موجودی</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1, h2 {
            text-align: center;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .search-container {
            margin-bottom: 20px;
            position: sticky;
            top: 10px;
            background: white;
            padding: 15px 0;
            z-index: 10;
        }
        #searchInput {
            width: 100%;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #ddd;
            box-sizing: border-box;
            font-size: 1rem;
        }
        .product-list {
            list-style: none;
            padding: 0;
            max-height: 50vh;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 6px;
        }
        .product-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        .product-item:last-child {
            border-bottom: none;
        }
        .product-item:nth-child(odd) {
            background-color: #fafafa;
        }
        .product-name {
            flex-grow: 1;
            margin-right: 15px;
        }
        .product-unit {
            font-size: 0.85em;
            color: #777;
            margin-right: 5px;
        }
        .product-checkbox {
            width: 20px;
            height: 20px;
            accent-color: #28a745;
            cursor: pointer;
        }
        #json-output {
            width: 100%;
            height: 200px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 0.9rem;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            direction: ltr;
        }
        #copy-button {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 15px;
            transition: background-color 0.3s;
        }
        #copy-button:hover {
            background-color: #0056b3;
        }
        #copy-button.copied {
            background-color: #28a745;
        }
        #product-count {
            text-align: center;
            color: #666;
            margin: 10px 0;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>پنل مدیریت موجودی</h1>

        <div class="search-container">
            <input type="text" id="searchInput" placeholder="جستجوی محصول...">
            <div id="product-count"></div>
        </div>

        <ul id="product-list" class="product-list">
            <!-- Products will be loaded here by JS -->
        </ul>

        <h2>خروجی JSON برای products.json</h2>
        <textarea id="json-output" readonly></textarea>
        <button id="copy-button">کپی کد JSON</button>
    </div>

    <script>
        const allProducts = [
            // This data is embedded to avoid fetch issues on local files
            // The JSON structure now includes "unit"
            { "name": "آرد برنج", "category": "حبوبات-و-غلات", "available": true, "unit": "گرم" },
            { "name": "آرد جو", "category": "حبوبات-و-غلات", "available": true, "unit": "گرم" },
            { "name": "آرد جوانه گندم", "category": "حبوبات-و-غلات", "available": true, "unit": "گرم" },
            { "name": "آرد گندم", "category": "حبوبات-و-غلات", "available": true, "unit": "گرم" },
            { "name": "آرد نخودچی", "category": "حبوبات-و-غلات", "available": true, "unit": "گرم" },
            { "name": "آویشن", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "آویشن شیرازی", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "اسپند", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "استخودوس", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "افتیمون", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "اکالیپتوس", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "انیسون", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "انجیر خشک", "category": "محصولات-خوراکی", "available": true, "unit": "گرم" },
            { "name": "بابا آدم", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "بابونه", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "بادرنجبویه", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "بارهنگ", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "برگ بو", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "برگ سنا", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "برگ گردو", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "برنج ایرانی", "category": "حبوبات-و-غلات", "available": true, "unit": "کیلو" },
            { "name": "بهار نارنج", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "به لیمو", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "بومادران", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "پاپایا", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "پاپل", "category": "متفرقه", "available": false, "unit": "عدد" },
            { "name": "پونه", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "پونه کوهی", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "پودر پاپریکا", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "پودر پیاز", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "پودر دارچین", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "پودر زنجبیل", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "پودر سیر", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "پودر لیمو", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "پودر نارگیل", "category": "محصولات-خوراکی", "available": true, "unit": "گرم" },
            { "name": "تاج ریزی", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "تخم بالنگا", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "تخم خرفه", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "تخم ریحان", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "تخم شربتی", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "تخم شوید", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "تخم کتان", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "تخم گشنیز", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "تخم کاهو", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "ترنجبین", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "جدوا", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "جوز هندی", "category": "ادویه-جات", "available": true, "unit": "عدد" },
            { "name": "جو دوسر پرک", "category": "حبوبات-و-غلات", "available": true, "unit": "گرم" },
            { "name": "جوهر لیمو", "category": "متفرقه", "available": true, "unit": "گرم" },
            { "name": "چای ترش", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "چای سبز", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "چای ماسالا", "category": "محصولات-خوراکی", "available": true, "unit": "گرم" },
            { "name": "چای کوهی", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "چهار تخم", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "چهارگل", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "چوب دارچین", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "حنا", "category": "شوینده-و-بهداشتی", "available": true, "unit": "گرم" },
            { "name": "خاکشیر", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "ختمی", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "خردل", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "دارچین", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "دار فلفل", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "رازیانه", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "رزماری", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "روغن آرگان", "category": "روغن-ها", "available": true, "unit": "عدد" },
            { "name": "روغن بادام تلخ", "category": "روغن-ها", "available": true, "unit": "عدد" },
            { "name": "روغن بادام شیرین", "category": "روغن-ها", "available": true, "unit": "عدد" },
            { "name": "روغن بنفشه", "category": "روغن-ها", "available": true, "unit": "عدد" },
            { "name": "روغن خراطین", "category": "روغن-ها", "available": true, "unit": "عدد" },
            { "name": "روغن سیاهدانه", "category": "روغن-ها", "available": true, "unit": "عدد" },
            { "name": "روغن کرچک", "category": "روغن-ها", "available": true, "unit": "عدد" },
            { "name": "روغن کنجد", "category": "روغن-ها", "available": true, "unit": "عدد" },
            { "name": "روغن مورد", "category": "روغن-ها", "available": true, "unit": "عدد" },
            { "name": "روغن نارگیل", "category": "روغن-ها", "available": true, "unit": "عدد" },
            { "name": "روغن زیتون", "category": "روغن-ها", "available": true, "unit": "عدد" },
            { "name": "زردچوبه", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "زعفران", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "زنجبیل", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "زنیان", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "زیره سبز", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "زیره سیاه", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "سدر", "category": "شوینده-و-بهداشتی", "available": true, "unit": "گرم" },
            { "name": "سرکه سیب", "category": "محصولات-خوراکی", "available": true, "unit": "بطری" },
            { "name": "سماق", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "سنجد", "category": "محصولات-خوراکی", "available": true, "unit": "گرم" },
            { "name": "سیاهدانه", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "شاتره", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "شاهسفرم", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "شکر سرخ", "category": "محصولات-خوراکی", "available": true, "unit": "گرم" },
            { "name": "شکر قهوه ای", "category": "محصولات-خوراکی", "available": true, "unit": "گرم" },
            { "name": "شنبلیله", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "شیر خشت", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "شیرین بیان", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "شیره انگور", "category": "محصولات-خوراکی", "available": true, "unit": "ظرف" },
            { "name": "شیره توت", "category": "محصولات-خوراکی", "available": true, "unit": "ظرف" },
            { "name": "شیره خرما", "category": "محصولات-خوراکی", "available": true, "unit": "ظرف" },
            { "name": "صابون", "category": "شوینده-و-بهداشتی", "available": true, "unit": "عدد" },
            { "name": "صابون زردچوبه", "category": "شوینده-و-بهداشتی", "available": true, "unit": "عدد" },
            { "name": "صمغ عربی", "category": "شوینده-و-بهداشتی", "available": true, "unit": "گرم" },
            { "name": "عسل", "category": "محصولات-خوراکی", "available": true, "unit": "ظرف" },
            { "name": "عناب", "category": "محصولات-خوراکی", "available": true, "unit": "گرم" },
            { "name": "عرق آلوورا", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق آویشن", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق اترج", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق اسطوخودوس", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق بادرنجبویه", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق بارهنگ", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق برگ چنار", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق برگ زیتون", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق برگ گردو", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق بومادران", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق بهارنارنج", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق بید", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق بیدمشک", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق پونه", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق خارخاسک", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق خارشتر", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق ختمی", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق رازیانه", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق زنیان", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق زیره", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق سنبل الطیب", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق شاتره", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق شنبلیله", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق شوید", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق شیرین بیان", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق کاسنی", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق کرفس", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق کیالک", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق گشنیز", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق گلاب", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق گزنه", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق مرزه", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق نعنا", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق هل", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "عرق یونجه", "category": "عرقیات", "available": true, "unit": "بطری" },
            { "name": "غنچه گل محمدی", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "فلفل سیاه", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "فلفل قرمز", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "فلوس", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "فیبر", "category": "متفرقه", "available": true, "unit": "عدد" },
            { "name": "قدومه", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "کندر", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "کنجد", "category": "حبوبات-و-غلات", "available": true, "unit": "گرم" },
            { "name": "کتیرا", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "گل بابونه", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "گل بنفشه", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "گل پنیرک", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "گل ختمی", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "گل زوفا", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "گل محمدی", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "گلرنگ", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "گلنار", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "گندم", "category": "حبوبات-و-غلات", "available": true, "unit": "کیلو" },
            { "name": "ماریانا", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "مازو", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "مخلصه", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "مرزنجوش", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "مریم گلی", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "موسیر", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "میخک", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "نعنا", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "نعنا خشک", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "نمک دریا", "category": "محصولات-خوراکی", "available": true, "unit": "گرم" },
            { "name": "هل", "category": "ادویه-جات", "available": true, "unit": "گرم" },
            { "name": "هلیله", "category": "گیاهان-دارویی", "available": true, "unit": "گرم" },
            { "name": "وایتکس", "category": "شوینده-و-بهداشتی", "available": true, "unit": "عدد" },
            { "name": "نشاسته", "category": "محصولات-خوراکی", "available": true, "unit": "گرم" }
        ];

        document.addEventListener('DOMContentLoaded', function() {
            const productList = document.getElementById('product-list');
            const jsonOutput = document.getElementById('json-output');
            const copyButton = document.getElementById('copy-button');
            const searchInput = document.getElementById('searchInput');
            const productCount = document.getElementById('product-count');

            function generateJson() {
                const updatedProducts = allProducts.map(product => {
                    const checkbox = document.getElementById(`prod-${product.name}`);
                    const isAvailable = checkbox ? checkbox.checked : product.available;
                    // This is the CRITICAL fix: we preserve the unit from the original data
                    return {
                        name: product.name,
                        category: product.category,
                        available: isAvailable,
                        unit: product.unit 
                    };
                });
                jsonOutput.value = JSON.stringify(updatedProducts, null, 2);
            }

            function renderProducts(filterText = '') {
                productList.innerHTML = '';
                let visibleProducts = 0;
                
                const sortedProducts = [...allProducts].sort((a, b) => a.name.localeCompare(b.name, 'fa'));

                sortedProducts.forEach(product => {
                    if (filterText && !product.name.includes(filterText)) {
                        return; // Skip if it doesn't match the search
                    }

                    const listItem = document.createElement('li');
                    listItem.className = 'product-item';
                    listItem.innerHTML = `
                        <span class="product-name">
                            ${product.name}
                            <span class="product-unit">(${product.unit || 'عدد'})</span>
                        </span>
                        <input type="checkbox" class="product-checkbox" id="prod-${product.name}" ${product.available ? 'checked' : ''}>
                    `;
                    productList.appendChild(listItem);
                    visibleProducts++;
                });

                productCount.textContent = `نمایش ${visibleProducts} از ${allProducts.length} محصول`;

                // Add event listeners after rendering
                document.querySelectorAll('.product-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', generateJson);
                });
            }

            searchInput.addEventListener('input', function() {
                renderProducts(this.value.trim());
            });

            copyButton.addEventListener('click', function() {
                generateJson(); // Ensure JSON is up-to-date before copying
                jsonOutput.select();
                document.execCommand('copy');
                
