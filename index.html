<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø³Ù†Ø¬Ø¯ | Ù†Ø³Ø®Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯</title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6B8E23">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Lalezar&family=Vazirmatn:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #6B8E23;
            --dark-green: #3A5210;
            --light-bg: #f8f9fa;
            --selected-bg: #eef5e0;
            --text-color: #444;
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
            --gold-color: #FFD700;
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            margin: 0; padding: 0 0 120px 0; /* Increased padding for keyboard space */
            background-color: var(--light-bg);
            color: var(--text-color);
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            width: 100vw;
        }

        /* --- Ù‡Ø¯Ø± --- */
        .header {
            position: relative;
            background: linear-gradient(135deg, #557C18 0%, #2d420b 100%);
            padding: 40px 20px 70px 20px;
            border-radius: 0 0 40px 40px;
            text-align: center; overflow: hidden;
            box-shadow: 0 10px 25px rgba(45, 66, 11, 0.3);
            z-index: 10;
        }
        .header-bg-icon {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 10rem; color: rgba(255,255,255,0.03); pointer-events: none;
        }
        .header h1 {
            font-family: 'Lalezar', cursive; margin: 0; font-size: 3.5rem; color: #fff;
            text-shadow: 0 4px 15px rgba(0,0,0,0.3); position: relative; z-index: 2;
        }
        .header p {
            font-weight: 300; margin: 5px 0 0;
            color: rgba(255, 255, 255, 0.85); font-size: 1rem; position: relative; z-index: 2;
        }

        .menu-toggle-btn {
            position: absolute; top: 20px; right: 20px;
            background: none; border: none; color: white;
            font-size: 1.8rem; cursor: pointer; z-index: 20; padding: 10px;
        }

        button:focus, input:focus { outline: none; }

        /* --- Ù…Ù†ÙˆÛŒ Ø¬Ø§Ù†Ø¨ÛŒ --- */
        .side-menu-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 998;
            opacity: 0; visibility: hidden; transition: 0.3s;
            backdrop-filter: blur(3px);
        }
        .side-menu-overlay.active { opacity: 1; visibility: visible; }

        .side-menu {
            position: fixed; top: 0; right: -280px; width: 280px; height: 100%;
            background: linear-gradient(180deg, #2d420b 0%, #1a2606 100%);
            z-index: 999; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: -5px 0 25px rgba(0,0,0,0.3);
            display: flex; flex-direction: column;
            overflow-y: auto;
        }
        .side-menu.active { right: 0; }
        .side-menu-header {
            padding: 25px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .close-menu-btn { background: none; border: none; color: white; font-size: 2rem; cursor: pointer; }
        
        .nav-links { padding: 20px 0; }
        .nav-item {
            display: flex; align-items: center; padding: 15px 25px;
            color: rgba(255,255,255,0.8); text-decoration: none; font-size: 1.1rem;
            transition: 0.2s; border-right: 3px solid transparent;
            cursor: pointer; /* Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ Ø¨Ø±Ø§ÛŒ Ø±ÙØªØ§Ø± Ø¯Ú©Ù…Ù‡ */
        }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: white; }
        .nav-item i { margin-left: 15px; width: 25px; text-align: center; color: var(--gold-color); }
        
        .install-pwa-btn {
            margin: 20px; padding: 12px; background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2); border-radius: 12px;
            color: var(--gold-color); cursor: pointer; font-family: 'Vazirmatn';
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }

        /* --- Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø§ØµÙ„ÛŒ --- */
        .container {
            max-width: 600px; margin: -50px auto 0 auto; padding: 0 20px;
            position: relative; z-index: 20;
        }

        /* --- Ø¬Ø³ØªØ¬Ùˆ (Sticky Fix) --- */
        .search-container {
            position: sticky; top: 15px; /* Ú†Ø³Ø¨Ø§Ù† Ø´Ø¯Ù† */
            background: white; padding: 5px; border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1); display: flex; align-items: center;
            margin-bottom: 25px; z-index: 90; /* Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ø¨Ù‚ÛŒÙ‡ Ø¹Ù†Ø§ØµØ± */
        }
        .search-icon { color: #999; margin: 0 15px; font-size: 1.2rem; }
        #search-input {
            border: none; width: 100%; padding: 15px 0; font-family: 'Vazirmatn'; font-size: 1rem;
            background: transparent;
        }

        /* --- Ø´Ø¨Ú©Ù‡â€ŒØ¨Ù†Ø¯ÛŒ --- */
        .categories-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .category-tile {
            background: white; border-radius: 25px; padding: 20px; height: 130px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            box-shadow: var(--shadow); cursor: pointer; transition: transform 0.2s;
            position: relative; overflow: hidden;
        }
        .category-tile:active { transform: scale(0.96); }
        
        /* Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ Ú©Ø§Ø´ÛŒâ€ŒÙ‡Ø§ */
        .cat-special { background: linear-gradient(135deg, #2c3e50, #3498db); }
        .cat-mixer { background: linear-gradient(135deg, #8E2DE2, #4A00E0); }
        .cat-remedy { background: linear-gradient(135deg, #eb3349, #f45c43); } /* Ú©Ø§Ø´ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¯Ø±Ù…Ø§Ù†â€ŒÚ¯Ø± */
        .cat-herbs { background: linear-gradient(135deg, #56ab2f, #a8e063); }
        .cat-spices { background: linear-gradient(135deg, #ff9966, #ff5e62); }
        .cat-liquids { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .cat-oils { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .cat-grains { background: linear-gradient(135deg, #e6b980, #eacda3); }
        .cat-hygiene { background: linear-gradient(135deg, #43e97b, #38f9d7); }
        .cat-food { background: linear-gradient(135deg, #fa709a, #fee140); }
        .cat-misc { background: linear-gradient(135deg, #a18cd1, #fbc2eb); }

        .tile-content { position: relative; z-index: 2; text-align: center; width:100%; }
        .tile-content i { font-size: 2.5rem; margin-bottom: 10px; color: #fff; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.2)); }
        .tile-content h2 { font-family: 'Lalezar', cursive; margin:0; font-size:1.3rem; text-shadow:0 2px 5px rgba(0,0,0,0.2); color: #fff; }

        /* --- Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ÛŒ --- */
        .inner-section { display: none; margin-top: 20px; background-color: white; padding:25px; border-radius:25px; box-shadow:var(--shadow); }
        .back-btn {
            background-color: #f0f2f5; color: #555; border:none; padding:10px 20px;
            border-radius:15px; cursor:pointer; font-family:'Vazirmatn'; font-weight:700;
            margin-bottom:20px; display:inline-flex; align-items:center; gap:8px;
        }

        .product-list { list-style:none; padding:0; margin:0; }
        .product-item {
            display:grid; grid-template-columns:auto auto 1fr auto; gap:10px;
            align-items:center; padding:15px 10px; border-bottom:1px solid #f4f4f4;
            border-radius:12px; margin-bottom:5px;
        }
        .product-item.selected { background-color:var(--selected-bg); border:1px solid var(--primary-color); }
        .product-checkbox { width:24px; height:24px; accent-color:var(--primary-color); }

        .star-btn {
            background:none; border:none; cursor:pointer; font-size:1.2rem; color:#ccc;
            padding:5px;
        }
        .star-btn.active { color:var(--gold-color); }

        .quantity-input-container { display:none; align-items:center; gap:10px; }
        .product-item.selected .quantity-input-container { display:flex; }
        .quantity-input { width:50px; padding:5px; border:2px solid #dce6c5; border-radius:10px; text-align:center; }
        .delete-btn { color:#ff4757; background:#ffeef0; border-radius:10px; width:32px; height:32px; display:flex; align-items:center; justify-content:center; cursor:pointer; }

        /* --- Ø¨Ø®Ø´ Ù…ÛŒÚ©Ø³Ø± (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡) --- */
        .mixer-wrapper { display:flex; flex-direction:column; align-items:center; gap:20px; user-select: none; }
        .size-selector { display:flex; gap:10px; margin-bottom:10px; }
        .size-btn { padding:8px 15px; border:1px solid #ddd; border-radius:20px; background:white; cursor:pointer; font-family:'Vazirmatn'; }
        .size-btn.active { background:#8E2DE2; color:white; border-color:#8E2DE2; }
        
        .supplements-shelf { 
            display:flex; gap:10px; overflow-x:auto; padding:10px 5px; width:100%; 
            scrollbar-width: none; -ms-overflow-style: none; /* Hide scrollbar */
        }
        .supplements-shelf::-webkit-scrollbar { display:none; }

        .supplement-jar {
            min-width:70px; height:90px; background:#f8f9fa; border:2px solid #eee; border-radius:15px;
            display:flex; flex-direction:column; align-items:center; justify-content:center;
            cursor:grab; position:relative; touch-action: none; /* Critical for Drag Fix */
        }
        .supplement-jar:active { cursor:grabbing; }
        .jar-lid { width:40px; height:10px; background:#ddd; border-radius:5px; margin-bottom:5px; }
        .jar-body { width:50px; height:50px; border-radius:10px; opacity:0.8; box-shadow:inset 0 0 10px rgba(0,0,0,0.1); }
        .jar-label { font-size:0.7rem; margin-top:5px; text-align:center; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; width:100%; }

        .mixing-area { position:relative; width:100%; height:260px; display:flex; justify-content:center; align-items:flex-end; }
        .flask-container { position:relative; width:160px; height:220px; display:flex; flex-direction:column-reverse; align-items:center; }
        .flask-glass {
            position:relative; width:100%; height:100%; background:rgba(255,255,255,0.1);
            border:4px solid rgba(255,255,255,0.6); border-top:none; border-radius:0 0 20px 20px;
            clip-path:polygon(20% 0,80% 0,100% 100%,0% 100%); overflow:hidden; backdrop-filter:blur(2px);
        }
        .powder-layer { width:100%; transition:height 0.4s; border-top:1px solid rgba(255,255,255,0.2); }

        /* --- Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³ --- */
        .wheel-container { position: relative; width: 300px; height: 300px; margin: 0 auto; }
        .wheel { width: 100%; height: 100%; border-radius: 50%; border: 10px solid #fff; box-shadow: 0 0 20px rgba(0,0,0,0.2); background: conic-gradient(#ff6b6b 0 60deg, #4ecdc4 60deg 120deg, #ffe66d 120deg 180deg, #ff9f43 180deg 240deg, #54a0ff 240deg 300deg, #5f27cd 300deg 360deg); transition: transform 4s cubic-bezier(0.17, 0.67, 0.83, 0.67); }
        .wheel-pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 25px solid #333; z-index: 10; }
        .spin-btn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; background: white; border-radius: 50%; border: none; font-family: 'Lalezar'; font-size: 1.2rem; cursor: pointer; box-shadow: 0 0 10px rgba(0,0,0,0.2); z-index: 5; }

        /* --- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø²Ù†Ø¯Ú¯ÛŒ Ø·ÛŒØ¨ --- */
        .tayeb-card { background: #fdfefe; border-right: 4px solid var(--primary-color); padding: 15px; border-radius: 10px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .tayeb-card h3 { margin: 0 0 10px 0; font-family: 'Lalezar'; color: var(--dark-green); display: flex; align-items: center; gap: 10px; }
        .tayeb-card p { font-size: 0.95rem; line-height: 1.6; color: #666; margin: 0; }

        /* --- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ù…Ø§Ù†â€ŒÚ¯Ø± --- */
        .remedy-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
        .remedy-btn { background: #fff5f5; border: 1px solid #fed7d7; color: #c53030; padding: 15px; border-radius: 12px; font-family: 'Vazirmatn'; font-weight: bold; cursor: pointer; transition: 0.2s; text-align: center; }
        .remedy-btn:hover, .remedy-btn.active { background: #c53030; color: white; transform: translateY(-2px); }

        .whatsapp-fab {
            position:fixed; bottom:25px; left:25px;
            background:linear-gradient(135deg,#25D366,#128C7E); color:white; width:65px; height:65px; border-radius:50%;
            display:flex; justify-content:center; align-items:center; font-size:2.5rem;
            box-shadow:0 10px 25px rgba(37,211,102,0.3); text-decoration:none;
            transform:scale(0); transition:all 0.4s; cursor:pointer; z-index:1000;
        }
        .whatsapp-fab.visible { transform:scale(1); }
        .cart-counter {
            position:absolute; top:0; right:0; background-color:#ff4757; color:white; border-radius:50%;
            width:24px; height:24px; font-size:0.8rem; font-weight:bold; display:flex; justify-content:center; align-items:center; border:2px solid white;
        }

        .special-form { display:flex; flex-direction:column; gap:20px; }
        .form-control { width:100%; padding:15px; border:2px solid #eee; border-radius:15px; font-size:1rem; box-sizing:border-box; font-family: 'Vazirmatn'; }
        .btn-submit-special { background:linear-gradient(135deg,#203a43,#2c5364); color:white; padding:15px; border:none; border-radius:15px; font-size:1.1rem; width:100%; cursor:pointer; font-family: 'Lalezar'; }

        /* Ghost element for drag and drop */
        .drag-ghost {
            position:fixed; pointer-events:none; z-index:9999; width:50px; height:50px;
            border-radius:50%; display:none; align-items:center; justify-content:center;
            color:white; border:2px solid white; font-family: 'Lalezar';
        }
    </style>
</head>
<body>

    <header class="header">
        <button class="menu-toggle-btn" aria-label="Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ù†Ùˆ" onclick="toggleMenu()">
            <i class="fa-solid fa-bars"></i>
        </button>
        <i class="fa-solid fa-leaf header-bg-icon"></i>
        <h1>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø³Ù†Ø¬Ø¯</h1>
        <p>Ø·Ø¨ÛŒØ¹Øª Ø±Ø§ Ø¨Ù‡ Ø®Ø§Ù†Ù‡ Ø®ÙˆØ¯ Ø¨ÛŒØ§ÙˆØ±ÛŒØ¯</p>
    </header>

    <div class="side-menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>

    <!-- Ù…Ù†ÙˆÛŒ Ø¬Ø§Ù†Ø¨ÛŒ -->
    <div class="side-menu" id="sideMenu">
        <div class="side-menu-header">
            <h3 style="margin:0; font-family:'Lalezar'; font-size:1.5rem; color:var(--gold-color)">Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ</h3>
            <button class="close-menu-btn" aria-label="Ø¨Ø³ØªÙ† Ù…Ù†Ùˆ" onclick="toggleMenu()">Ã—</button>
        </div>

        <div class="nav-links">
            <!-- FIX: Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ Ø¨Ù‡ Ø¬Ø§ÛŒ ØªÚ¯ a Ø¨Ù‡ ØªÚ¯ div ØªØ¨Ø¯ÛŒÙ„ Ø´Ø¯Ù†Ø¯ ØªØ§ Ø§Ø² Ø±ÙØ±Ø´ ØµÙØ­Ù‡ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø´ÙˆØ¯ -->
            <div class="nav-item" onclick="navigate('home'); toggleMenu()">
                <i class="fa-solid fa-house"></i> Ø®Ø§Ù†Ù‡
            </div>
            <div class="nav-item" onclick="navigate('remedy'); toggleMenu()">
                <i class="fa-solid fa-user-doctor"></i> Ù…Ø´Ø§ÙˆØ± Ù‡ÙˆØ´Ù…Ù†Ø¯
            </div>
            <div class="nav-item" onclick="navigate('wheel'); toggleMenu()">
                <i class="fa-solid fa-dharmachakra"></i> Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³
            </div>
            <div class="nav-item" onclick="navigate('tayeb'); toggleMenu()">
                <i class="fa-solid fa-heart-pulse"></i> Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ Ø³Ø§Ù„Ù…
            </div>
        </div>

        <div style="border-top:1px solid rgba(255,255,255,0.1); margin:10px 20px;"></div>
        <div style="padding: 0 20px; margin-bottom: 10px; color: var(--gold-color); font-size: 0.9rem;">Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</div>

        <div id="favoritesList" style="padding: 0 20px; flex-grow: 1; overflow-y: auto;"></div>

        <button id="install-btn" class="install-pwa-btn">
            <i class="fa-solid fa-download"></i> Ù†ØµØ¨ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†
        </button>

        <div style="text-align:center; font-size:0.8rem; color:rgba(255,255,255,0.4); padding:20px;">
            Senjed Store v3.7 (Menu Fixed)
        </div>
    </div>

    <div class="container">
        <div class="search-container">
            <i class="fa-solid fa-search search-icon"></i>
            <input type="search" id="search-input" placeholder="Ø¬Ø³ØªØ¬Ùˆ (Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„ØŒ Ø¨ÛŒÙ…Ø§Ø±ÛŒ...)" autocomplete="off">
        </div>

        <!-- ØµÙØ­Ù‡ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ (Ø®Ø§Ù†Ù‡) -->
        <div id="category-view">
            <div class="categories-grid">
                <div class="category-tile cat-special" onclick="navigate('special')">
                    <div class="tile-content"><i class="fa-solid fa-star"></i><h2>Ø³ÙØ§Ø±Ø´ Ù…Ø­ØµÙˆÙ„ Ø®Ø§Øµ</h2></div>
                </div>
                <div class="category-tile cat-remedy" onclick="navigate('remedy')">
                    <div class="tile-content"><i class="fa-solid fa-user-doctor"></i><h2>Ø¯Ø±Ù…Ø§Ù†â€ŒÚ¯Ø± (Ù‡ÙˆØ´Ù…Ù†Ø¯)</h2></div>
                </div>
                <div class="category-tile cat-mixer" onclick="initMixer(); navigate('mixer')">
                    <div class="tile-content"><i class="fa-solid fa-flask"></i><h2>Ù…ÛŒÚ©Ø³ Ù…Ú©Ù…Ù„ (Ø¢Ø²Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡)</h2></div>
                </div>
                <!-- Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¹Ø§Ø¯ÛŒ -->
                <div class="category-tile cat-herbs" data-category="Ú¯ÛŒØ§Ù‡Ø§Ù†-Ø¯Ø§Ø±ÙˆÛŒÛŒ"><div class="tile-content"><i class="fa-solid fa-leaf"></i><h2>Ú¯ÛŒØ§Ù‡Ø§Ù† Ø¯Ø§Ø±ÙˆÛŒÛŒ</h2></div></div>
                <div class="category-tile cat-spices" data-category="Ø§Ø¯ÙˆÛŒÙ‡-Ø¬Ø§Øª"><div class="tile-content"><i class="fa-solid fa-mortar-pestle"></i><h2>Ø§Ø¯ÙˆÛŒÙ‡â€ŒØ¬Ø§Øª</h2></div></div>
                <div class="category-tile cat-liquids" data-category="Ø¹Ø±Ù‚ÛŒØ§Øª"><div class="tile-content"><i class="fa-solid fa-bottle-droplet"></i><h2>Ø¹Ø±Ù‚ÛŒØ§Øª</h2></div></div>
                <div class="category-tile cat-oils" data-category="Ø±ÙˆØºÙ†-Ù‡Ø§"><div class="tile-content"><i class="fa-solid fa-oil-well"></i><h2>Ø±ÙˆØºÙ†â€ŒÙ‡Ø§</h2></div></div>
                <div class="category-tile cat-grains" data-category="Ø­Ø¨ÙˆØ¨Ø§Øª-Ùˆ-ØºÙ„Ø§Øª"><div class="tile-content"><i class="fa-solid fa-wheat-awn"></i><h2>Ø­Ø¨ÙˆØ¨Ø§Øª</h2></div></div>
                <div class="category-tile cat-hygiene" data-category="Ø´ÙˆÛŒÙ†Ø¯Ù‡-Ùˆ-Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒ"><div class="tile-content"><i class="fa-solid fa-pump-soap"></i><h2>Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒ</h2></div></div>
                <div class="category-tile cat-food" data-category="Ù…Ø­ØµÙˆÙ„Ø§Øª-Ø®ÙˆØ±Ø§Ú©ÛŒ"><div class="tile-content"><i class="fa-solid fa-jar"></i><h2>Ø®ÙˆØ±Ø§Ú©ÛŒ</h2></div></div>
                <div class="category-tile cat-misc" data-category="Ù…ØªÙØ±Ù‚Ù‡"><div class="tile-content"><i class="fa-solid fa-box-open"></i><h2>Ø³Ø§ÛŒØ±</h2></div></div>
            </div>
        </div>

        <!-- Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª -->
        <div id="product-view" class="inner-section">
            <button class="back-btn" onclick="history.back()"><i class="fa-solid fa-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            <h2 id="category-title" style="font-family:'Lalezar'; color:#3A5210; margin-top:0;"></h2>
            <ul id="product-list" class="product-list"></ul>
        </div>

        <!-- Ø³ÙØ§Ø±Ø´ Ø®Ø§Øµ -->
        <div id="special-request-view" class="inner-section">
            <button class="back-btn" onclick="history.back()"><i class="fa-solid fa-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            <h2 style="font-family:'Lalezar'; color:#203a43;">Ø³ÙØ§Ø±Ø´ Ù…Ø­ØµÙˆÙ„ Ú©Ù…ÛŒØ§Ø¨</h2>
            <div class="special-form">
                <input type="text" id="special-name" class="form-control" placeholder="Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„">
                <input type="text" id="special-details" class="form-control" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ùˆ ÙˆØ²Ù† (Ù…Ø«Ù„Ø§: ÛµÛ°Û° Ú¯Ø±Ù…)">
                <button class="btn-submit-special" onclick="sendSpecialRequest()"><i class="fab fa-whatsapp"></i> Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ÙˆØ§ØªØ³â€ŒØ§Ù¾</button>
            </div>
        </div>

        <!-- Ù…ÛŒÚ©Ø³Ø± (Ø¢Ø²Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡) -->
        <div id="mixer-view" class="inner-section" style="background:#fff9fc;">
            <button class="back-btn" onclick="history.back()"><i class="fa-solid fa-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            <div class="mixer-wrapper">
                <h2 style="font-family:'Lalezar'; color:#8E2DE2; margin:0;">Ø¢Ø²Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ Ù…Ú©Ù…Ù„</h2>
                <p style="font-size:0.8rem; color:#666;">Ø´ÛŒØ´Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ú©Ø´ÛŒØ¯ Ùˆ Ø¯Ø§Ø®Ù„ ÙÙ„Ø§Ø³Ú© Ø±Ù‡Ø§ Ú©Ù†ÛŒØ¯</p>
                <div class="size-selector">
                    <button class="size-btn" onclick="setMixerSize(500,50,this)">Ù†ÛŒÙ… Ú©ÛŒÙ„Ùˆ</button>
                    <button class="size-btn active" onclick="setMixerSize(1000,100,this)">ÛŒÚ© Ú©ÛŒÙ„Ùˆ</button>
                    <button class="size-btn" onclick="setMixerSize(5000,250,this)">Ù¾Ù†Ø¬ Ú©ÛŒÙ„Ùˆ</button>
                </div>
                <div class="supplements-shelf" id="shelf"></div>
                <div class="mixing-area">
                    <div class="flask-container" id="flask-target">
                        <div class="flask-neck" style="position:absolute; top:-35px; left:50%; transform:translateX(-50%); width:50px; height:40px; background:rgba(255,255,255,0.1); border:4px solid rgba(255,255,255,0.6); border-bottom:none; border-radius:5px 5px 0 0; z-index:1;"></div>
                        <div class="flask-glass" id="flask-content"></div>
                        <div id="current-weight" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-family:'Lalezar'; font-size:1.5rem; z-index:10; background:rgba(255,255,255,0.7); padding:2px 10px; border-radius:10px;">0</div>
                    </div>
                </div>
                <div id="mix-list" style="width:100%; margin-top:10px; text-align: center; font-size: 0.9rem;"></div>
            </div>
        </div>

        <!-- Ø¯Ø±Ù…Ø§Ù†â€ŒÛŒØ§Ø¨ (Ù…Ø´Ø§ÙˆØ± Ù‡ÙˆØ´Ù…Ù†Ø¯) -->
        <div id="remedy-view" class="inner-section">
            <button class="back-btn" onclick="history.back()"><i class="fa-solid fa-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            <div style="text-align:center;">
                <i class="fa-solid fa-user-doctor" style="font-size:3rem; color:#eb3349;"></i>
                <h2 style="font-family:'Lalezar'; color:#eb3349; margin:10px 0;">Ù…Ø´Ø§ÙˆØ± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø³Ù†Ø¬Ø¯</h2>
                <p style="color:#666; font-size:0.9rem;">Ù…Ø´Ú©Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ØªØ§ Ø¨Ù‡ØªØ±ÛŒÙ† Ù…Ø­ØµÙˆÙ„Ø§Øª Ø±Ø§ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¯Ù‡ÛŒÙ…:</p>
            </div>
            <div id="ailment-grid" class="remedy-grid">
                <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
            </div>
        </div>

        <!-- Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³ -->
        <div id="wheel-view" class="inner-section">
            <button class="back-btn" onclick="history.back()"><i class="fa-solid fa-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            <h2 style="text-align:center; font-family:'Lalezar'; color:#EE5A24;">Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³ Ø³Ù†Ø¬Ø¯</h2>
            <p style="text-align:center; color:#666;">Ø´Ø§Ù†Ø³ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø¯ ØªØ®ÙÛŒÙ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯!</p>
            <div class="wheel-container">
                <div class="wheel-pointer"></div>
                <div class="wheel" id="lucky-wheel"></div>
                <button class="spin-btn" onclick="spinWheel()">Ø¨Ú†Ø±Ø®Ø§Ù†!</button>
            </div>
        </div>

        <!-- Ø²Ù†Ø¯Ú¯ÛŒ Ø·ÛŒØ¨ (Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ Ø³Ø§Ù„Ù…) -->
        <div id="tayeb-view" class="inner-section">
            <button class="back-btn" onclick="history.back()"><i class="fa-solid fa-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            <div style="text-align:center; margin-bottom:20px;">
                <i class="fa-solid fa-leaf" style="font-size:3rem; color:var(--primary-color);"></i>
                <h2 style="font-family:'Lalezar'; margin:10px 0; color:var(--dark-green);">Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ Ø³Ø§Ù„Ù… (Ø·ÛŒØ¨)</h2>
                <span style="color:#888;">Ø²Ù†Ø¯Ú¯ÛŒ Ø¨Ø§ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø·Ø¨ÛŒØ¹ÛŒ</span>
            </div>
            <div class="tayeb-card">
                <h3><i class="fa-solid fa-apple-whole"></i> ØªØºØ°ÛŒÙ‡ Ø³Ø§Ù„Ù…</h3>
                <p>Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ Ø§Ø±Ú¯Ø§Ù†ÛŒÚ© Ùˆ Ø¯ÙˆØ±ÛŒ Ø§Ø² Ù…ÙˆØ§Ø¯ Ù†Ú¯Ù‡Ø¯Ø§Ø±Ù†Ø¯Ù‡ØŒ Ø§ÙˆÙ„ÛŒÙ† Ù‚Ø¯Ù… Ø¯Ø± Ù…Ø³ÛŒØ± Ø²Ù†Ø¯Ú¯ÛŒ Ø·ÛŒØ¨ Ø§Ø³Øª.</p>
            </div>
            <div class="tayeb-card">
                <h3><i class="fa-solid fa-heart-pulse"></i> Ù…Ø²Ø§Ø¬â€ŒØ´Ù†Ø§Ø³ÛŒ</h3>
                <p>Ø´Ù†Ø§Ø®Øª Ø·Ø¨Ø¹ Ùˆ Ù…Ø²Ø§Ø¬ Ø®ÙˆØ¯ ÛŒÚ©ÛŒ Ø§Ø² Ø§ØµÙˆÙ„ Ø·Ø¨ Ø³Ù†ØªÛŒ Ø§Ø³Øª. Ø¨Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø±Ø³Øª Ù…ØµÙ„Ø­â€ŒÙ‡Ø§ Ø³Ù„Ø§Ù…ØªÛŒ Ø®ÙˆØ¯ Ø±Ø§ ØªØ¶Ù…ÛŒÙ† Ú©Ù†ÛŒØ¯.</p>
            </div>
            <div class="tayeb-card">
                <h3><i class="fa-solid fa-mug-hot"></i> Ø¢Ø±Ø§Ù…Ø´ Ø·Ø¨ÛŒØ¹ÛŒ</h3>
                <p>Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ø±Ø¯Ù† Ú†Ø§ÛŒ Ø³ÛŒØ§Ù‡ Ø¨Ø§ Ø¯Ù…Ù†ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ú¯ÛŒØ§Ù‡ÛŒ Ù…Ø§Ù†Ù†Ø¯ Ú¯Ù„â€ŒÚ¯Ø§ÙˆØ²Ø¨Ø§Ù† Ùˆ Ø¨Ù‡Ø§Ø±Ù†Ø§Ø±Ù†Ø¬ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù‡Ø´ Ø§Ø³ØªØ±Ø³.</p>
            </div>
        </div>

    </div>

    <div id="whatsapp-button" class="whatsapp-fab">
        <i class="fab fa-whatsapp"></i>
        <span id="cart-counter" class="cart-counter"></span>
    </div>

    <div id="drag-ghost" class="drag-ghost"></div>

    <script>
        // --- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ùˆ Ù…ØªØºÛŒØ±Ù‡Ø§ ---
        const whatsappNumber = "9890000000"; // Ø´Ù…Ø§Ø±Ù‡ ÙˆØ§ØªØ³â€ŒØ§Ù¾ Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯
        let allProducts = [];
        const backupProducts = [
            {id:1, name:"Ø¹Ø³Ù„ Ú©ÙˆÙ‡ÛŒ", category:"Ø®ÙˆØ±Ø§Ú©ÛŒ", unit:"Ú©ÛŒÙ„Ùˆ"},
            {id:2, name:"Ø²Ø¹ÙØ±Ø§Ù† Ù‚Ø§Ø¦Ù†Ø§Øª", category:"Ø§Ø¯ÙˆÛŒÙ‡-Ø¬Ø§Øª", unit:"Ù…Ø«Ù‚Ø§Ù„"},
            {id:3, name:"Ø¹Ø±Ù‚ Ù†Ø¹Ù†Ø§ Ø¯ÙˆØ¢ØªÛŒØ´Ù‡", category:"Ø¹Ø±Ù‚ÛŒØ§Øª", unit:"Ù„ÛŒØªØ±"},
            {id:4, name:"Ø±ÙˆØºÙ† Ø²ÛŒØªÙˆÙ† ÙØ±Ø§Ø¨Ú©Ø±", category:"Ø±ÙˆØºÙ†-Ù‡Ø§", unit:"Ù„ÛŒØªØ±"},
            {id:5, name:"Ù†Ø®ÙˆØ¯ Ú©Ø±Ù…Ø§Ù†Ø´Ø§Ù‡ÛŒ", category:"Ø­Ø¨ÙˆØ¨Ø§Øª-Ùˆ-ØºÙ„Ø§Øª", unit:"Ú©ÛŒÙ„Ùˆ"},
            {id:6, name:"ØµØ§Ø¨ÙˆÙ† Ø²Ø±Ø¯Ú†ÙˆØ¨Ù‡", category:"Ø´ÙˆÛŒÙ†Ø¯Ù‡-Ùˆ-Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒ", unit:"Ø¹Ø¯Ø¯"},
            {id:7, name:"Ú¯Ù„ Ú¯Ø§Ùˆ Ø²Ø¨Ø§Ù†", category:"Ú¯ÛŒØ§Ù‡Ø§Ù†-Ø¯Ø§Ø±ÙˆÛŒÛŒ", unit:"Ú¯Ø±Ù…"},
            {id:8, name:"Ù¾ÙˆØ¯Ø± Ø³Ù†Ø¬Ø¯", category:"Ø¢Ø±Ø¯-Ùˆ-Ù¾ÙˆØ¯Ø±", unit:"Ú©ÛŒÙ„Ùˆ"},
            {id:9, name:"Ø®Ø§Ú©Ø´ÛŒØ±", category:"Ú¯ÛŒØ§Ù‡Ø§Ù†-Ø¯Ø§Ø±ÙˆÛŒÛŒ", unit:"Ú©ÛŒÙ„Ùˆ"}
        ];

        // Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ DOM
        const productList = document.getElementById('product-list');
        const searchInput = document.getElementById('search-input');
        const whatsappBtn = document.getElementById('whatsapp-button');
        const cartCounter = document.getElementById('cart-counter');
        const categoryView = document.getElementById('category-view');
        const favoritesListEl = document.getElementById('favoritesList');
        const sideMenu = document.getElementById('sideMenu');
        const menuOverlay = document.getElementById('menuOverlay');

        // Ù„ÛŒØ³Øª Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ù…Ø§Ù†â€ŒÚ¯Ø±
        const ailments = [
            { name: 'Ø³Ø±Ù…Ø§Ø®ÙˆØ±Ø¯Ú¯ÛŒ', keywords: ['Ø¢ÙˆÛŒØ´Ù†', 'Ù¾ÙˆÙ†Ù‡', 'Ø¹Ø³Ù„', 'Ù†Ø¹Ù†Ø§', 'Ø§Ú©Ø§Ù„ÛŒÙ¾ØªÙˆØ³'] },
            { name: 'Ú©Ø¨Ø¯ Ú†Ø±Ø¨', keywords: ['Ú©Ø§Ø³Ù†ÛŒ', 'Ø´Ø§ØªØ±Ù‡', 'Ø®Ø§Ø±Ø´ØªØ±', 'Ø²Ø±Ø¯Ú†ÙˆØ¨Ù‡', 'Ø³Ø±Ú©Ù‡'] },
            { name: 'Ø±ÛŒØ²Ø´ Ù…Ùˆ', keywords: ['Ø±Ø²Ù…Ø§Ø±ÛŒ', 'Ø¨Ù†ÙØ´Ù‡', 'Ø¨Ø§Ø¯Ø§Ù… ØªÙ„Ø®', 'Ø³Ø¨ÙˆØ³', 'Ø­Ù†Ø§'] },
            { name: 'Ù„Ø§ØºØ±ÛŒ', keywords: ['Ø²ÛŒØ±Ù‡', 'Ú©Ø±ÙØ³', 'Ú†Ø§ÛŒ Ø³Ø¨Ø²', 'Ø³ÛŒØ±', 'Ø³Ø±Ú©Ù‡ Ø³ÛŒØ¨'] },
            { name: 'Ú†Ø§Ù‚ÛŒ (Ø§ÙØ²Ø§ÛŒØ´ ÙˆØ²Ù†)', keywords: ['Ø¬Ù†Ø³ÛŒÙ†Ú¯', 'ÛŒÙˆÙ†Ø¬Ù‡', 'Ú©Ù†Ø¬Ø¯', 'Ø´ÛŒØ±Ù‡', 'Ø§Ø±Ø¯Ù‡'] },
            { name: 'Ø¯ÛŒØ§Ø¨Øª', keywords: ['Ú¯Ø²Ù†Ù‡', 'Ø´Ù†Ø¨Ù„ÛŒÙ„Ù‡', 'Ø¯Ø§Ø±Ú†ÛŒÙ†', 'Ø¨ÙˆÙ‚Ù†Ø§Ù‚', 'Ú¯Ø±Ø¯Ùˆ'] },
            { name: 'ÙØ´Ø§Ø± Ø®ÙˆÙ†', keywords: ['Ú†Ø§ÛŒ ØªØ±Ø´', 'Ø³ÛŒØ±', 'Ø²ÛŒØªÙˆÙ†', 'Ø¢Ù„ÛŒØ³Ø§', 'Ø³Ù†Ø¨Ù„'] },
            { name: 'Ø¢Ø±Ø§Ù…Ø´ Ø§Ø¹ØµØ§Ø¨', keywords: ['Ú¯Ø§ÙˆØ²Ø¨Ø§Ù†', 'Ø³Ù†Ø¨Ù„', 'Ø¨Ù‡Ø§Ø±Ù†Ø§Ø±Ù†Ø¬', 'Ø§Ø³Ø·ÙˆØ®ÙˆØ¯ÙˆØ³', 'Ø¨Ø§Ø¨ÙˆÙ†Ù‡'] },
            { name: 'Ù…Ø´Ú©Ù„Ø§Øª Ù…Ø¹Ø¯Ù‡', keywords: ['Ù†Ø¹Ù†Ø§', 'Ø´ÛŒØ±ÛŒÙ† Ø¨ÛŒØ§Ù†', 'Ø¨Ø§Ø±Ù‡Ù†Ú¯', 'Ø²Ù†ÛŒØ§Ù†', 'Ù¾ÙˆÙ†Ù‡'] },
            { name: 'ÛŒØ¨ÙˆØ³Øª', keywords: ['Ø§Ù†Ø¬ÛŒØ±', 'Ø®Ø§Ú©Ø´ÛŒØ±', 'Ø¢Ù„Ùˆ', 'Ø²ÛŒØªÙˆÙ†', 'Ø³Ù†Ø§'] },
            { name: 'Ø³Ù†Ú¯ Ú©Ù„ÛŒÙ‡', keywords: ['Ø®Ø§Ø±Ø´ØªØ±', 'Ø®Ø§Ø±Ø®Ø§Ø³Ú©', 'Ú©Ø§Ø§Ù„', 'Ø¢Ø¨'] },
            { name: 'Ú©Ù… Ø®ÙˆÙ†ÛŒ', keywords: ['Ø³Ù‡ Ø´ÛŒØ±Ù‡', 'Ø´ÛŒØ±Ù‡ Ø§Ù†Ú¯ÙˆØ±', 'Ù¾Ø³ØªÙ‡', 'Ø¹Ø¯Ø³', 'Ø§Ø³ÙÙ†Ø§Ø¬'] },
            { name: 'Ù¾ÙˆØ³Øª Ùˆ Ø²ÛŒØ¨Ø§ÛŒÛŒ', keywords: ['Ø¢Ù„ÙˆØ¦Ù‡', 'Ø¨Ø§Ø¯Ø§Ù… Ø´ÛŒØ±ÛŒÙ†', 'Ú¯Ù„Ø§Ø¨', 'Ø³Ø¯Ø±', 'Ø³ÙÛŒØ¯Ø§Ø¨'] },
            { name: 'ØªÙ‚ÙˆÛŒØª Ø­Ø§ÙØ¸Ù‡', keywords: ['Ú©Ù†Ø¯Ø±', 'Ø³Ø¹Ø¯', 'Ù…ÙˆÛŒØ²', 'Ú¯Ø±Ø¯Ùˆ', 'Ø¹Ø³Ù„'] },
            { name: 'Ø¯Ø±Ø¯ Ù…ÙØ§ØµÙ„', keywords: ['Ø³ÛŒØ§Ù‡Ø¯Ø§Ù†Ù‡', 'Ø²Ù†Ø¬Ø¨ÛŒÙ„', 'ÙÙ„ÙÙ„', 'Ø´ØªØ±Ù…Ø±Øº', 'Ø§Ø³Ù¾Ù†Ø¯'] }
        ];

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
        fetch('products.json')
            .then(response => {
                if (!response.ok) throw new Error("Failed");
                return response.json();
            })
            .then(data => {
                allProducts = data;
                initApp();
            })
            .catch(() => {
                allProducts = backupProducts;
                initApp();
            });

        // --- Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ (Persistent) ---
        let shoppingCart = JSON.parse(localStorage.getItem('senjedCart')) || [];
        let favorites = JSON.parse(localStorage.getItem('senjedFavorites')) || [];

        function initApp() {
            updateFavoritesMenu();
            renderAilmentButtons(); // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¯Ø±Ù…Ø§Ù†â€ŒÚ¯Ø±
            updateCartAndButton(); // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯
        }

        function normalizeText(text) {
            // Ø­Ø°Ù Ø§Ø¹Ø±Ø§Ø¨ Ùˆ ÛŒÚ©Ø³Ø§Ù†â€ŒØ³Ø§Ø²ÛŒ ÛŒ Ùˆ Ú©
            return text.replace(/[\u064B-\u065F]/g, '')
                       .replace(/ÙŠ/g, "ÛŒ")
                       .replace(/Ùƒ/g, "Ú©")
                       .trim().toLowerCase();
        }

        // --- Ù†Ø§ÙˆØ¨Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ (History API) ---
        window.navigate = function(target, params = null) {
            // Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡
            categoryView.style.display = 'none';
            document.querySelectorAll('.inner-section').forEach(el => el.style.display = 'none');
            
            // Ù†Ù…Ø§ÛŒØ´ Ù‡Ø¯Ù
            if (target === 'home') {
                categoryView.style.display = 'block';
                history.pushState({view: 'home'}, '', '#home');
            } else if (target === 'product-list') {
                document.getElementById('product-view').style.display = 'block';
                // Params contains products and title
            } else {
                const sectionMap = {
                    'remedy': 'remedy-view',
                    'wheel': 'wheel-view',
                    'tayeb': 'tayeb-view',
                    'special': 'special-request-view',
                    'mixer': 'mixer-view'
                };
                if (sectionMap[target]) {
                    document.getElementById(sectionMap[target]).style.display = 'block';
                    history.pushState({view: target}, '', '#' + target);
                }
            }
            window.scrollTo(0, 0);
        };

        window.onpopstate = function(event) {
            if (sideMenu.classList.contains('active')) {
                toggleMenu(); // Ø§Ú¯Ø± Ù…Ù†Ùˆ Ø¨Ø§Ø² Ø¨ÙˆØ¯ØŒ ÙÙ‚Ø· Ù…Ù†Ùˆ Ø±Ø§ Ø¨Ø¨Ù†Ø¯
                return;
            }
            
            // Ù…Ù†Ø·Ù‚ Ø¨Ø§Ø²Ú¯Ø´Øª
            if (!event.state || event.state.view === 'home') {
                categoryView.style.display = 'block';
                document.querySelectorAll('.inner-section').forEach(el => el.style.display = 'none');
            } else {
                // Ø§Ú¯Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ø§ Ø¨Ú© Ø²Ø¯Ù† Ø¨Ù‡ Ø¹Ù‚Ø¨ Ø¨Ø±Ú¯Ø±Ø¯Ø¯ØŒ Ù‡Ù…ÛŒÙ† Ú©Ø§ÙÛŒØ³Øª.
                // Ø¨Ø±Ø§ÛŒ UX Ø¨Ù‡ØªØ± Ù…Ø¹Ù…ÙˆÙ„Ø§ Ø¨Ú© Ø²Ø¯Ù† Ø¨Ù‡ Ù„ÛŒØ³Øª Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯
                categoryView.style.display = 'block';
                document.querySelectorAll('.inner-section').forEach(el => el.style.display = 'none');
            }
        };

        // --- ØªÙˆØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ ---
        function renderProductList(products, title) {
            const list = document.getElementById('product-list');
            document.getElementById('category-title').textContent = title;
            list.innerHTML = '';
            
            products.forEach(product => {
                const inCart = shoppingCart.find(i => i.name === product.name && i.type === 'standard');
                const li = document.createElement('li');
                li.className = `product-item ${inCart ? 'selected' : ''}`;
                const isFav = favorites.includes(product.name);
                
                li.innerHTML = `
                    <button class="star-btn ${isFav ? 'active' : ''}" data-fav-name="${product.name}" onclick="toggleFavorite('${product.name}', event)">
                        <i class="${isFav ? 'fa-solid' : 'fa-regular'} fa-star"></i>
                    </button>
                    <input type="checkbox" class="product-checkbox" ${inCart ? 'checked' : ''}>
                    <div>
                        <div style="font-weight:700;">${product.name}</div>
                        <div style="font-size:0.8rem; color:#888;">${product.category}</div>
                    </div>
                    <div class="quantity-input-container">
                        <input type="tel" class="quantity-input" value="${inCart ? inCart.quantity : 1}" placeholder="ØªØ¹Ø¯Ø§Ø¯">
                        <span style="font-size:0.8rem;">${product.unit}</span>
                        <div class="delete-btn"><i class="fa-solid fa-trash"></i></div>
                    </div>
                `;
                list.appendChild(li);
            });

            // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø³ØªÛŒ Ú†ÙˆÙ† Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø®Ø§Ø±Ø¬ Ø§Ø² Ø³ÛŒØ³ØªÙ… state Ø§Ø³Øª
            categoryView.style.display='none';
            document.querySelectorAll('.inner-section').forEach(el=>el.style.display='none');
            document.getElementById('product-view').style.display='block';
            history.pushState({view: 'products'}, '', '#products');
        }

        // Event Delegation for Product List
        productList.addEventListener('change', e => {
            if (e.target.classList.contains('product-checkbox')) {
                const li = e.target.closest('.product-item');
                if (e.target.checked) {
                    li.classList.add('selected');
                    setTimeout(() => li.querySelector('.quantity-input').focus(), 50);
                } else {
                    li.classList.remove('selected');
                }
                updateCartAndButton();
            }
        });

        productList.addEventListener('click', e => {
            if (e.target.closest('.delete-btn')) {
                const li = e.target.closest('.product-item');
                li.querySelector('.product-checkbox').checked = false;
                li.classList.remove('selected');
                updateCartAndButton();
            }
        });

        productList.addEventListener('input', e => {
            if (e.target.classList.contains('quantity-input')) updateCartAndButton();
        });

        // Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§
        document.querySelectorAll('.category-tile[data-category]').forEach(tile => {
            tile.addEventListener('click', function() {
                const cat = this.dataset.category;
                const name = this.querySelector('h2').textContent;
                renderProductList(allProducts.filter(p => p.category === cat), name);
            });
        });

        // --- Ø¬Ø³ØªØ¬Ùˆ ---
        let searchTimeout;
        searchInput.addEventListener('input', () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const term = normalizeText(searchInput.value);
                if (term) {
                    // Ø¬Ø³ØªØ¬ÙˆÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¯Ø± Ù†Ø§Ù… Ùˆ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
                    const results = allProducts.filter(p => 
                        normalizeText(p.name).includes(term) || 
                        normalizeText(p.category).includes(term)
                    );
                    renderProductList(results, `Ù†ØªØ§ÛŒØ¬: Â«${searchInput.value}Â»`);
                } else {
                    navigate('home');
                }
            }, 300);
        });

        // --- Ø¯Ø±Ù…Ø§Ù†â€ŒÚ¯Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ ---
        function renderAilmentButtons() {
            const grid = document.getElementById('ailment-grid');
            grid.innerHTML = '';
            ailments.forEach(ailment => {
                const btn = document.createElement('div');
                btn.className = 'remedy-btn';
                btn.textContent = ailment.name;
                btn.onclick = () => suggestRemedies(ailment);
                grid.appendChild(btn);
            });
        }

        function suggestRemedies(ailment) {
            // ÛŒØ§ÙØªÙ† Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…Ø±ØªØ¨Ø· Ø¨Ø§ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ Ø¨ÛŒÙ…Ø§Ø±ÛŒ
            const results = allProducts.filter(product => {
                const prodName = normalizeText(product.name);
                return ailment.keywords.some(key => prodName.includes(normalizeText(key)));
            });

            if (results.length > 0) {
                renderProductList(results, `Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø±Ø§ÛŒ: ${ailment.name}`);
            } else {
                alert('Ù…ØªØ§Ø³ÙØ§Ù†Ù‡ Ù…Ø­ØµÙˆÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù…ÙˆØ±Ø¯ ÛŒØ§ÙØª Ù†Ø´Ø¯.');
            }
        }

        // --- Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ùˆ ÙˆØ§ØªØ³â€ŒØ§Ù¾ ---
        function updateCartAndButton() {
            shoppingCart = [];
            
            // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯
            document.querySelectorAll('.product-item.selected').forEach(li => {
                const name = li.querySelector('div > div:first-child').textContent;
                const q = li.querySelector('.quantity-input').value;
                const unit = li.querySelector('.quantity-input-container span').textContent;
                if (q > 0) shoppingCart.push({ type: 'standard', name, quantity: q, unit });
            });
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…ÛŒÚ©Ø³â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ (Ø§Ú¯Ø± Ù‡Ø³ØªÙ†Ø¯)
            // (Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø³Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ØŒ Ø¨Ø±Ø§ÛŒ Ø­ÙØ¸ Ù…ÛŒÚ©Ø³â€ŒÙ‡Ø§ Ø¨Ø§ÛŒØ¯ Ù…ØªØºÛŒØ± Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¯Ø§Ø´Øª ÛŒØ§ Ø¯Ø± Ù„ÙˆÚ©Ø§Ù„ Ø§Ø³ØªÙˆØ±ÛŒØ¬ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø±Ø¯)
            // ÙØ¹Ù„Ø§ Ù…ÛŒÚ©Ø³â€ŒÙ‡Ø§ ÙÙ‚Ø· ØªØ§ Ø²Ù…Ø§Ù† Ø±ÙØ±Ø´ Ø¯Ø± Ø¢Ø±Ø§ÛŒÙ‡ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ù†Ø¯ØŒ Ø¨Ø±Ø§ÛŒ Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„ Ø¨Ø§ÛŒØ¯ Ù…ÛŒÚ©Ø³â€ŒÙ‡Ø§ Ø±Ø§ Ø¬Ø¯Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ø±Ø¯
            // Ø§Ù…Ø§ Ú†ÙˆÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª "Ø­ÙØ¸ Ø³Ø¨Ø¯" Ø¨ÙˆØ¯ØŒ Ù…Ø§ Ú©Ù„ shoppingCart Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒÚ©Ù†ÛŒÙ….
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± LocalStorage
            localStorage.setItem('senjedCart', JSON.stringify(shoppingCart));

            const count = shoppingCart.length;
            cartCounter.textContent = count;
            cartCounter.style.display = count > 0 ? 'flex' : 'none';
            
            if (count > 0) {
                whatsappBtn.classList.add('visible');
            } else {
                whatsappBtn.classList.remove('visible');
            }
        }

        whatsappBtn.addEventListener('click', () => {
            if (shoppingCart.length === 0) return;
            let msg = "Ø³Ù„Ø§Ù… ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø³Ù†Ø¬Ø¯ØŒ Ø³ÙØ§Ø±Ø´ Ù…Ù†:\n\n";
            shoppingCart.forEach(i => {
                if(i.type === 'standard') {
                    msg += `â–ªï¸ ${i.name}: ${i.quantity} ${i.unit}\n`;
                } else if (i.type === 'mix') {
                    msg += `ğŸ§ª Ù…ÛŒÚ©Ø³ ${i.weightLabel}:\n   ${i.details}\n`;
                }
            });
            window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(msg)}`, '_blank');
        });

        // --- Ù…Ù†Ùˆ Ùˆ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ ---
        window.toggleMenu = function() {
            sideMenu.classList.toggle('active');
            menuOverlay.classList.toggle('active');
        };

        window.toggleFavorite = function(productName, event) {
            event.stopPropagation();
            const idx = favorites.indexOf(productName);
            if (idx === -1) favorites.push(productName);
            else favorites.splice(idx, 1);
            localStorage.setItem('senjedFavorites', JSON.stringify(favorites));

            // Ø¢Ù¾Ø¯ÛŒØª Ø¸Ø§Ù‡Ø± Ø¯Ú©Ù…Ù‡
            const btn = document.querySelector(`.star-btn[data-fav-name="${productName}"]`);
            if (btn) {
                btn.classList.toggle('active');
                const icon = btn.querySelector('i');
                icon.className = btn.classList.contains('active') ? 'fa-solid fa-star' : 'fa-regular fa-star';
            }
            updateFavoritesMenu();
        };

        function updateFavoritesMenu() {
            favoritesListEl.innerHTML = '';
            if (favorites.length === 0) {
                favoritesListEl.innerHTML = '<div style="text-align:center; color:rgba(255,255,255,0.6); margin-top:20px; font-size:0.9rem;">Ù„ÛŒØ³Øª Ø®Ø§Ù„ÛŒ Ø§Ø³Øª</div>';
                return;
            }
            favorites.forEach(name => {
                const div = document.createElement('div');
                div.style.cssText = 'display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.05); color:white;';
                div.innerHTML = `<span>${name}</span><i class="fa-solid fa-trash" style="cursor:pointer; color:#ff4757;" onclick="toggleFavorite('${name}', event)"></i>`;
                favoritesListEl.appendChild(div);
            });
        }

        // --- Ø§Ø±Ø³Ø§Ù„ Ø³ÙØ§Ø±Ø´ Ø®Ø§Øµ ---
        window.sendSpecialRequest = function() {
            const n = document.getElementById('special-name').value;
            const d = document.getElementById('special-details').value;
            if(!n) return alert('Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
            window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(`Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø®Ø§Øµ:\nÙ…Ø­ØµÙˆÙ„: ${n}\nØªÙˆØ¶ÛŒØ­Ø§Øª: ${d}`)}`,'_blank');
        };

        // --- PWA Installer ---
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-btn').addEventListener('click', () => {
                if(deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then(() => deferredPrompt = null);
                } else {
                    alert('Ù„Ø·ÙØ§ Ø§Ø² Ù…Ù†ÙˆÛŒ Ù…Ø±ÙˆØ±Ú¯Ø± Ú¯Ø²ÛŒÙ†Ù‡ Add to Home Screen Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.');
                }
            });
        });

        // --- Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³ ---
        window.spinWheel = function() {
            const wheel = document.getElementById('lucky-wheel');
            const btn = document.querySelector('.spin-btn');
            btn.disabled = true;
            const deg = Math.floor(2000 + Math.random() * 3000);
            wheel.style.transform = `rotate(${deg}deg)`;
            setTimeout(() => {
                alert('ØªØ¨Ø±ÛŒÚ©! Ú©Ø¯ ØªØ®ÙÛŒÙ: SENJED10');
                btn.disabled = false;
            }, 4000);
        };

        // --- Ù„Ø§Ø¬ÛŒÚ© Ù…ÛŒÚ©Ø³Ø± (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÙˆÙ„) ---
        let mixerConfig = { max:1000, step:100 }, currentFlaskWeight = 0, flaskIngredients = [];
        const jarColors = ['#FF6B6B','#4ECDC4','#FFE66D','#FF9F43','#54A0FF','#5F27CD','#C4E538','#FDA7DF','#D980FA'];

        window.initMixer = function() {
            const shelf = document.getElementById('shelf');
            shelf.innerHTML = '';
            
            // ÙÙ‚Ø· Ù…Ø­ØµÙˆÙ„Ø§ØªÛŒ Ú©Ù‡ Ù¾ÙˆØ¯Ø±ÛŒ Ù‡Ø³ØªÙ†Ø¯
            const powders = allProducts.filter(p => p.category === 'Ø¢Ø±Ø¯-Ùˆ-Ù¾ÙˆØ¯Ø±' || p.category === 'Ø§Ø¯ÙˆÛŒÙ‡-Ø¬Ø§Øª' || p.category.includes('Ù¾ÙˆØ¯Ø±'));
            const displayItems = powders.length > 0 ? powders : allProducts.slice(0, 10); // ÙØ§Ù„â€ŒØ¨Ú©

            displayItems.forEach((p, i) => {
                const jar = document.createElement('div');
                jar.className = 'supplement-jar';
                jar.innerHTML = `
                    <div class="jar-lid"></div>
                    <div class="jar-body" style="background:${jarColors[i % jarColors.length]}"></div>
                    <div class="jar-label">${p.name}</div>
                `;
                
                // --- Logic Drag & Drop Touch ---
                let isDragging = false;
                let startX, startY;
                const ghost = document.getElementById('drag-ghost');

                jar.addEventListener('touchstart', (e) => {
                    isDragging = false; 
                    // No e.preventDefault() here to allow scroll!
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                    
                    // ØªØ§ÛŒÙ…Ø± Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ "Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÙ†" Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ú¯ (Ù†Ù‡ Ø§Ø³Ú©Ø±ÙˆÙ„)
                    jar.dragTimer = setTimeout(() => {
                        isDragging = true;
                        navigator.vibrate(50); // Haptic feedback
                        ghost.style.display = 'flex';
                        ghost.style.backgroundColor = jarColors[i % jarColors.length];
                        ghost.textContent = p.name;
                        ghost.style.left = e.touches[0].clientX + 'px';
                        ghost.style.top = e.touches[0].clientY + 'px';
                    }, 200);
                }, { passive: false });

                jar.addEventListener('touchmove', (e) => {
                    if (isDragging) {
                        e.preventDefault(); // Stop scrolling NOW because we are dragging
                        ghost.style.left = e.touches[0].clientX + 'px';
                        ghost.style.top = e.touches[0].clientY + 'px';
                    } else {
                        // If moved significantly before timer, cancel drag (it's a scroll)
                        const moveX = Math.abs(e.touches[0].clientX - startX);
                        const moveY = Math.abs(e.touches[0].clientY - startY);
                        if (moveY > 10 || moveX > 10) {
                            clearTimeout(jar.dragTimer);
                        }
                    }
                }, { passive: false });

                jar.addEventListener('touchend', (e) => {
                    clearTimeout(jar.dragTimer);
                    if (isDragging) {
                        isDragging = false;
                        ghost.style.display = 'none';
                        const touch = e.changedTouches[0];
                        checkDrop(touch.clientX, touch.clientY, p.name, jarColors[i % jarColors.length]);
                    }
                });

                shelf.appendChild(jar);
            });
        };

        function checkDrop(x, y, name, color) {
            const flask = document.getElementById('flask-target').getBoundingClientRect();
            if (x >= flask.left && x <= flask.right && y >= flask.top && y <= flask.bottom) {
                if (currentFlaskWeight >= mixerConfig.max) return alert('Ø¸Ø±Ù Ù¾Ø± Ø´Ø¯Ù‡ Ø§Ø³Øª!');
                
                currentFlaskWeight += mixerConfig.step;
                flaskIngredients.push(name);
                
                // Ø§ÙØ²ÙˆØ¯Ù† Ù„Ø§ÛŒÙ‡ Ø¨ØµØ±ÛŒ
                const layer = document.createElement('div');
                layer.className = 'powder-layer';
                layer.style.background = color;
                layer.style.height = (mixerConfig.step / mixerConfig.max * 100) + '%';
                document.getElementById('flask-content').appendChild(layer);
                
                document.getElementById('current-weight').textContent = currentFlaskWeight;
                updateMixList();
            }
        }

        window.setMixerSize = function(size, step, btn) {
            mixerConfig = { max: size, step: step };
            document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            resetFlask();
        };

        function resetFlask() {
            currentFlaskWeight = 0;
            flaskIngredients = [];
            document.getElementById('flask-content').innerHTML = '';
            document.getElementById('current-weight').textContent = '0';
            updateMixList();
        }

        function updateMixList() {
            const list = document.getElementById('mix-list');
            if (currentFlaskWeight === 0) {
                list.innerHTML = '';
                return;
            }
            
            // Ø´Ù…Ø§Ø±Ø´ Ù…ÙˆØ§Ø¯
            const counts = {};
            flaskIngredients.forEach(x => counts[x] = (counts[x] || 0) + 1);
            
            let html = `<b>Ù…Ø­ØªÙˆÛŒØ§Øª (${currentFlaskWeight} Ú¯Ø±Ù…):</b><br>`;
            for (const [name, count] of Object.entries(counts)) {
                html += `${name}: ${count * mixerConfig.step} Ú¯Ø±Ù…<br>`;
            }
            
            if (currentFlaskWeight >= mixerConfig.max) {
                html += `<button onclick="addToCartMix()" style="margin-top:10px; background:#8E2DE2; color:white; border:none; padding:5px 15px; border-radius:10px;">Ø§ÙØ²ÙˆØ¯Ù† Ù…ÛŒÚ©Ø³ Ø¨Ù‡ Ø³Ø¨Ø¯</button>`;
            }
            list.innerHTML = html;
        }

        window.addToCartMix = function() {
            // Ø³Ø§Ø®ØªÙ† Ø§Ø³Ù… Ùˆ ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…ÛŒÚ©Ø³
            const counts = {};
            flaskIngredients.forEach(x => counts[x] = (counts[x] || 0) + 1);
            let details = [];
            for (const [name, count] of Object.entries(counts)) {
                details.push(`${name} (${count * mixerConfig.step}g)`);
            }
            
            shoppingCart.push({
                type: 'mix',
                name: 'Ù…ÛŒÚ©Ø³ Ø§Ø®ØªØµØ§ØµÛŒ',
                weightLabel: mixerConfig.max + ' Ú¯Ø±Ù…ÛŒ',
                quantity: 1,
                details: details.join(' + ')
            });
            
            updateCartAndButton();
            alert('Ù…ÛŒÚ©Ø³ Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
            resetFlask();
            navigate('home');
        };

    </script>
</body>
</html>
