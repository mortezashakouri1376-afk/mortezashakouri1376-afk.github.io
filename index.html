<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø³Ù†Ø¬Ø¯ | Ù†Ø³Ø®Ù‡ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡</title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6B8E23">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Lalezar&family=Vazirmatn:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-grad: linear-gradient(135deg, #6B8E23 0%, #3A5210 100%);
            --accent-color: #FFD700;
            --bg-color: #f8f9fa;
            --text-main: #333;
            --shadow-soft: 0 10px 20px rgba(0,0,0,0.08);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Vazirmatn', sans-serif;
            margin: 0; padding: 0 0 100px 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            overflow-x: hidden;
            width: 100%;
        }

        /* --- Animations --- */
        @keyframes fadeInMove {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* --- Header --- */
        .header {
            position: relative;
            background: linear-gradient(135deg, #557C18, #3A5210);
            padding: 40px 20px 70px 20px;
            border-radius: 0 0 40px 40px;
            text-align: center; overflow: hidden;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            z-index: 10;
        }
        .header-bg-icon {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 10rem; color: rgba(255,255,255,0.05); pointer-events: none;
        }
        .header h1 {
            font-family: 'Lalezar', cursive; margin: 0; font-size: 3.5rem; color: #fff;
            text-shadow: 0 4px 10px rgba(0,0,0,0.3); position: relative; z-index: 2;
        }
        .header p {
            margin: 5px 0 0; color: rgba(255, 255, 255, 0.9); font-size: 1rem; position: relative; z-index: 2;
        }

        .menu-toggle-btn {
            position: absolute; top: 20px; right: 20px;
            background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);
            border-radius: 12px; width: 40px; height: 40px; color: white;
            font-size: 1.2rem; cursor: pointer; z-index: 20;
        }

        /* --- Container & Search --- */
        .container { 
            max-width: 800px; margin: -50px auto 0 auto; padding: 0 20px; 
            position: relative; z-index: 20; 
        }

        .search-container {
            background: #ffffff;
            padding: 5px 15px; border-radius: 50px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex; align-items: center; margin-bottom: 25px;
            border: 2px solid #fff;
        }
        .search-icon { color: #6B8E23; margin-left: 10px; font-size: 1.2rem; }
        #search-input { 
            border: none; width: 100%; padding: 15px 0; 
            font-family: 'Vazirmatn'; font-size: 1rem; outline: none; 
        }

        /* --- Grid & Tiles --- */
        .categories-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        
        .category-tile {
            position: relative; border-radius: 20px; height: 130px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            box-shadow: var(--shadow-soft); cursor: pointer;
            overflow: hidden; text-align: center; color: white;
            /* FIX: Opacity removed, animation added */
            animation: fadeInMove 0.6s ease-out;
        }
        
        .cat-special { background: linear-gradient(135deg, #2c3e50, #4ca1af); }
        .cat-mixer { background: linear-gradient(135deg, #8E2DE2, #4A00E0); }
        .cat-remedy { background: linear-gradient(135deg, #ff416c, #ff4b2b); }
        .cat-herbs { background: linear-gradient(135deg, #11998e, #38ef7d); }
        .cat-spices { background: linear-gradient(135deg, #f2709c, #ff9472); }
        .cat-liquids { background: linear-gradient(135deg, #00c6ff, #0072ff); }
        .cat-oils { background: linear-gradient(135deg, #fc4a1a, #f7b733); }
        .cat-grains { background: linear-gradient(135deg, #eacda3, #d6ae7b); }
        .cat-hygiene { background: linear-gradient(135deg, #56ab2f, #a8e063); }
        .cat-food { background: linear-gradient(135deg, #ff0844, #ffb199); }
        .cat-misc { background: linear-gradient(135deg, #c33764, #1d2671); }

        .tile-content i { font-size: 2.5rem; margin-bottom: 10px; display: block; }
        .tile-content h2 { font-family: 'Lalezar'; margin: 0; font-size: 1.2rem; }

        /* --- Sections --- */
        .inner-section {
            display: none; background: #fff; padding: 20px; border-radius: 20px;
            box-shadow: var(--shadow-soft); margin-top: 20px;
            animation: fadeInMove 0.4s ease-out;
        }

        .back-btn {
            background: #f1f1f1; border: none; padding: 10px 20px;
            border-radius: 15px; cursor: pointer; font-family: 'Vazirmatn';
            font-weight: bold; margin-bottom: 20px; display: inline-flex; align-items: center; gap: 8px;
        }

        /* --- Product List --- */
        .product-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; border-bottom: 1px solid #eee; margin-bottom: 10px;
            background: #fcfcfc; border-radius: 12px;
            /* FIX: Default opacity is 1 */
            animation: fadeInMove 0.5s ease-out;
        }
        .product-item.selected { background: #f0f7e6; border: 1px solid #6B8E23; }
        .product-checkbox { width: 20px; height: 20px; margin-left: 10px; accent-color: #6B8E23; }
        
        .quantity-input-container { display: flex; align-items: center; gap: 5px; }
        .quantity-input { width: 50px; padding: 5px; border: 1px solid #ddd; border-radius: 8px; text-align: center; }
        .delete-btn { color: red; margin-right: 10px; cursor: pointer; }

        /* --- Wheel --- */
        .wheel-container { position: relative; width: 280px; height: 280px; margin: 20px auto; }
        .wheel {
            width: 100%; height: 100%; border-radius: 50%;
            border: 10px solid #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            background: conic-gradient(#ff6b6b 0 60deg, #4ecdc4 60deg 120deg, #ffe66d 120deg 180deg, #ff9f43 180deg 240deg, #54a0ff 240deg 300deg, #5f27cd 300deg 360deg);
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
        }
        .spin-btn {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 60px; height: 60px; background: #fff; border-radius: 50%;
            border: 3px solid #eee; font-family: 'Lalezar'; cursor: pointer; z-index: 5;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        /* --- Mixer --- */
        .supplements-shelf {
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px;
            background: #8B4513; padding: 15px 5px; border-radius: 10px; margin-bottom: 20px;
        }
        .supplement-jar {
            background: rgba(255,255,255,0.8); height: 50px; border-radius: 5px;
            display: flex; justify-content: center; align-items: center; font-size: 0.7rem; cursor: grab;
        }
        .flask-container {
            width: 120px; height: 160px; margin: 0 auto; position: relative;
        }
        .flask-glass {
            width: 100%; height: 100%; background: rgba(255,255,255,0.3); border: 2px solid #ccc;
            border-radius: 0 0 40px 40px; overflow: hidden; position: relative;
        }
        .powder-layer { width: 100%; }

        /* --- Side Menu --- */
        .side-menu-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 998;
            display: none;
        }
        .side-menu-overlay.active { display: block; }

        .side-menu {
            position: fixed; top: 0; right: -280px; width: 260px; height: 100%;
            background: #2d3436; z-index: 999; transition: 0.3s;
            color: #fff; display: flex; flex-direction: column;
        }
        .side-menu.active { right: 0; }
        .nav-item { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); cursor: pointer; }
        .nav-item i { margin-left: 10px; color: var(--accent-color); }

        /* --- Floating Button --- */
        .whatsapp-fab {
            position: fixed; bottom: 20px; left: 20px;
            background: #25D366; color: white; width: 60px; height: 60px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; font-size: 2.5rem;
            box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4); z-index: 100;
            text-decoration: none; display: none; /* Initially hidden */
        }
        .whatsapp-fab.visible { display: flex; animation: float 3s infinite ease-in-out; }
        .cart-counter {
            position: absolute; top: 0; right: 0; background: red; color: white;
            border-radius: 50%; width: 24px; height: 24px; font-size: 0.8rem;
            display: flex; justify-content: center; align-items: center; border: 2px solid white;
        }

        .remedy-btn {
            background: #ffe0e0; color: #c0392b; padding: 15px; border-radius: 10px;
            text-align: center; font-weight: bold; cursor: pointer; margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <header class="header">
        <button class="menu-toggle-btn" onclick="toggleMenu()">
            <i class="fa-solid fa-bars"></i>
        </button>
        <i class="fa-solid fa-leaf header-bg-icon"></i>
        <h1>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø³Ù†Ø¬Ø¯</h1>
        <p>Ø·Ø¨ÛŒØ¹Øª Ø±Ø§ Ø¨Ù‡ Ø®Ø§Ù†Ù‡ Ø®ÙˆØ¯ Ø¨ÛŒØ§ÙˆØ±ÛŒØ¯</p>
    </header>

    <div class="side-menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>

    <div class="side-menu" id="sideMenu">
        <div style="padding: 20px; border-bottom:1px solid rgba(255,255,255,0.1); display:flex; justify-content:space-between;">
            <span style="font-family:'Lalezar'; font-size:1.5rem;">Ù…Ù†Ùˆ</span>
            <i class="fa-solid fa-times" onclick="toggleMenu()" style="cursor:pointer; font-size:1.5rem;"></i>
        </div>
        <div class="nav-item" onclick="navigate('home'); toggleMenu()"><i class="fa-solid fa-house"></i> Ø®Ø§Ù†Ù‡</div>
        <div class="nav-item" onclick="navigate('remedy'); toggleMenu()"><i class="fa-solid fa-user-doctor"></i> Ù…Ø´Ø§ÙˆØ± Ù‡ÙˆØ´Ù…Ù†Ø¯</div>
        <div class="nav-item" onclick="navigate('wheel'); toggleMenu()"><i class="fa-solid fa-dharmachakra"></i> Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³</div>
        <div class="nav-item" onclick="navigate('tayeb'); toggleMenu()"><i class="fa-solid fa-heart-pulse"></i> Ø²Ù†Ø¯Ú¯ÛŒ Ø·ÛŒØ¨</div>
        
        <div style="padding:20px; font-size:0.9rem; color:#aaa; margin-top:auto;">
            Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§:
            <div id="favoritesList" style="margin-top:10px; color:#fff;"></div>
        </div>
    </div>

    <div class="container">
        <!-- Ú©Ø§Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ -->
        <div class="search-container">
            <i class="fa-solid fa-search search-icon"></i>
            <input type="search" id="search-input" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø­ØµÙˆÙ„..." autocomplete="off">
        </div>

        <!-- Ù†Ù…Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ (Ø®Ø§Ù†Ù‡) -->
        <div id="category-view">
            <div class="categories-grid">
                <div class="category-tile cat-special" onclick="navigate('special')">
                    <div class="tile-content"><i class="fa-solid fa-star"></i><h2>Ø³ÙØ§Ø±Ø´ Ø®Ø§Øµ</h2></div>
                </div>
                <div class="category-tile cat-remedy" onclick="navigate('remedy')">
                    <div class="tile-content"><i class="fa-solid fa-user-doctor"></i><h2>Ù…Ø´Ø§ÙˆØ± Ù‡ÙˆØ´Ù…Ù†Ø¯</h2></div>
                </div>
                <div class="category-tile cat-mixer" onclick="initMixer(); navigate('mixer')">
                    <div class="tile-content"><i class="fa-solid fa-flask"></i><h2>Ø¢Ø²Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡</h2></div>
                </div>
                <div class="category-tile cat-herbs" data-category="Ú¯ÛŒØ§Ù‡Ø§Ù†-Ø¯Ø§Ø±ÙˆÛŒÛŒ"><div class="tile-content"><i class="fa-solid fa-leaf"></i><h2>Ú¯ÛŒØ§Ù‡Ø§Ù† Ø¯Ø§Ø±ÙˆÛŒÛŒ</h2></div></div>
                <div class="category-tile cat-spices" data-category="Ø§Ø¯ÙˆÛŒÙ‡-Ø¬Ø§Øª"><div class="tile-content"><i class="fa-solid fa-mortar-pestle"></i><h2>Ø§Ø¯ÙˆÛŒÙ‡â€ŒØ¬Ø§Øª</h2></div></div>
                <div class="category-tile cat-liquids" data-category="Ø¹Ø±Ù‚ÛŒØ§Øª"><div class="tile-content"><i class="fa-solid fa-bottle-droplet"></i><h2>Ø¹Ø±Ù‚ÛŒØ§Øª</h2></div></div>
                <div class="category-tile cat-oils" data-category="Ø±ÙˆØºÙ†-Ù‡Ø§"><div class="tile-content"><i class="fa-solid fa-oil-well"></i><h2>Ø±ÙˆØºÙ†â€ŒÙ‡Ø§</h2></div></div>
                <div class="category-tile cat-grains" data-category="Ø­Ø¨ÙˆØ¨Ø§Øª-Ùˆ-ØºÙ„Ø§Øª"><div class="tile-content"><i class="fa-solid fa-wheat-awn"></i><h2>Ø­Ø¨ÙˆØ¨Ø§Øª</h2></div></div>
                <div class="category-tile cat-hygiene" data-category="Ø´ÙˆÛŒÙ†Ø¯Ù‡-Ùˆ-Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒ"><div class="tile-content"><i class="fa-solid fa-pump-soap"></i><h2>Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒ</h2></div></div>
                <div class="category-tile cat-food" data-category="Ù…Ø­ØµÙˆÙ„Ø§Øª-Ø®ÙˆØ±Ø§Ú©ÛŒ"><div class="tile-content"><i class="fa-solid fa-jar"></i><h2>Ø®ÙˆØ±Ø§Ú©ÛŒ</h2></div></div>
                <div class="category-tile cat-misc" data-category="Ù…ØªÙØ±Ù‚Ù‡"><div class="tile-content"><i class="fa-solid fa-box-open"></i><h2>Ø³Ø§ÛŒØ±</h2></div></div>
            </div>
        </div>

        <!-- Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª -->
        <div id="product-view" class="inner-section">
            <button class="back-btn" onclick="navigate('home')"><i class="fa-solid fa-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            <h2 id="category-title" style="font-family:'Lalezar'; margin-top:0;"></h2>
            <div id="product-list"></div>
        </div>

        <!-- Ø¨Ø®Ø´ Ù…Ø´Ø§ÙˆØ± -->
        <div id="remedy-view" class="inner-section">
            <button class="back-btn" onclick="navigate('home')"><i class="fa-solid fa-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            <h2 style="font-family:'Lalezar'; text-align:center;">Ù…Ø´Ø§ÙˆØ± Ù‡ÙˆØ´Ù…Ù†Ø¯</h2>
            <div id="ailment-grid" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;"></div>
        </div>

        <!-- Ø¨Ø®Ø´ Ú¯Ø±Ø¯ÙˆÙ†Ù‡ -->
        <div id="wheel-view" class="inner-section">
            <button class="back-btn" onclick="navigate('home')"><i class="fa-solid fa-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            <h2 style="text-align:center; font-family:'Lalezar';">Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³</h2>
            <div class="wheel-container">
                <div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 30px solid #333; z-index: 10;"></div>
                <div class="wheel" id="lucky-wheel"></div>
                <button class="spin-btn" onclick="spinWheel()">Ø¨Ú†Ø±Ø®Ø§Ù†</button>
            </div>
        </div>

        <!-- Ø¨Ø®Ø´ Ù…ÛŒÚ©Ø³ -->
        <div id="mixer-view" class="inner-section">
            <button class="back-btn" onclick="navigate('home')"><i class="fa-solid fa-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            <h2 style="font-family:'Lalezar'; color:#8E2DE2;">Ø¢Ø²Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ Ù…Ú©Ù…Ù„</h2>
            <div class="supplements-shelf" id="shelf"></div>
            <div class="flask-container" id="flask-target">
                <div class="flask-glass" id="flask-content"></div>
                <div id="current-weight" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-weight:bold; font-size:1.5rem;">0g</div>
            </div>
        </div>

        <!-- Ø³Ø§ÛŒØ± Ø¨Ø®Ø´â€ŒÙ‡Ø§ -->
        <div id="special-request-view" class="inner-section">
            <button class="back-btn" onclick="navigate('home')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            <h3>Ø³ÙØ§Ø±Ø´ Ù…Ø­ØµÙˆÙ„ Ø®Ø§Øµ</h3>
            <input type="text" id="special-name" style="width:100%; padding:10px; margin-bottom:10px;" placeholder="Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„">
            <button onclick="sendSpecialRequest()" style="width:100%; padding:10px; background:#333; color:#fff; border:none; border-radius:5px;">Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ÙˆØ§ØªØ³â€ŒØ§Ù¾</button>
        </div>

        <div id="tayeb-view" class="inner-section">
            <button class="back-btn" onclick="navigate('home')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            <h3>Ø²Ù†Ø¯Ú¯ÛŒ Ø·ÛŒØ¨</h3>
            <p>ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø³Ø¨Ú© Ø²Ù†Ø¯Ú¯ÛŒ Ø³Ø§Ù„Ù…...</p>
        </div>

    </div>

    <a id="whatsapp-button" class="whatsapp-fab">
        <i class="fab fa-whatsapp"></i>
        <span id="cart-counter" class="cart-counter">0</span>
    </a>
    
    <!-- Ghost element for dragging -->
    <div id="drag-ghost" style="position:fixed; width:40px; height:40px; background:red; border-radius:50%; display:none; z-index:9999; pointer-events:none;"></div>

    <script>
        const whatsappNumber = "989918022066";
        let allProducts = [];
        let shoppingCart = JSON.parse(localStorage.getItem('senjedCart')) || [];
        let favorites = JSON.parse(localStorage.getItem('senjedFavorites')) || [];

        // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ (Ø§Ú¯Ø± ÙØ§ÛŒÙ„ json Ù„ÙˆØ¯ Ù†Ø´Ø¯)
        const fallbackProducts = [
            {name:"Ø¹Ø³Ù„ Ú©ÙˆÙ‡ÛŒ", category:"Ø®ÙˆØ±Ø§Ú©ÛŒ", unit:"Ú©ÛŒÙ„Ùˆ"},
            {name:"Ø²Ø¹ÙØ±Ø§Ù† Ù…Ù…ØªØ§Ø²", category:"Ø§Ø¯ÙˆÛŒÙ‡-Ø¬Ø§Øª", unit:"Ù…Ø«Ù‚Ø§Ù„"},
            {name:"Ú¯Ù„ Ú¯Ø§Ùˆ Ø²Ø¨Ø§Ù†", category:"Ú¯ÛŒØ§Ù‡Ø§Ù†-Ø¯Ø§Ø±ÙˆÛŒÛŒ", unit:"Ú¯Ø±Ù…"},
            {name:"Ø¹Ø±Ù‚ Ù†Ø¹Ù†Ø§", category:"Ø¹Ø±Ù‚ÛŒØ§Øª", unit:"Ù„ÛŒØªØ±"},
            {name:"Ø±ÙˆØºÙ† Ø²ÛŒØªÙˆÙ†", category:"Ø±ÙˆØºÙ†-Ù‡Ø§", unit:"Ù„ÛŒØªØ±"},
            {name:"ØµØ§Ø¨ÙˆÙ† Ù…Ø±Ø§ØºÙ‡", category:"Ø´ÙˆÛŒÙ†Ø¯Ù‡-Ùˆ-Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒ", unit:"Ø¹Ø¯Ø¯"},
            {name:"Ù†Ø®ÙˆØ¯", category:"Ø­Ø¨ÙˆØ¨Ø§Øª-Ùˆ-ØºÙ„Ø§Øª", unit:"Ú©ÛŒÙ„Ùˆ"},
            {name:"Ø¢ÙˆÛŒØ´Ù† Ø´ÛŒØ±Ø§Ø²ÛŒ", category:"Ú¯ÛŒØ§Ù‡Ø§Ù†-Ø¯Ø§Ø±ÙˆÛŒÛŒ", unit:"Ú¯Ø±Ù…"}
        ];

        const ailments = [
            { name: 'Ø³Ø±Ù…Ø§Ø®ÙˆØ±Ø¯Ú¯ÛŒ', keywords: ['Ø¢ÙˆÛŒØ´Ù†', 'Ù¾ÙˆÙ†Ù‡', 'Ø¹Ø³Ù„'] },
            { name: 'Ú©Ø¨Ø¯ Ú†Ø±Ø¨', keywords: ['Ú©Ø§Ø³Ù†ÛŒ', 'Ø´Ø§ØªØ±Ù‡'] },
            { name: 'Ø±ÛŒØ²Ø´ Ù…Ùˆ', keywords: ['Ø±Ø²Ù…Ø§Ø±ÛŒ', 'Ø¨Ù†ÙØ´Ù‡'] },
            { name: 'Ù„Ø§ØºØ±ÛŒ', keywords: ['Ø²ÛŒØ±Ù‡', 'Ú©Ø±ÙØ³', 'Ú†Ø§ÛŒ Ø³Ø¨Ø²'] },
            { name: 'Ø¢Ø±Ø§Ù…Ø´ Ø§Ø¹ØµØ§Ø¨', keywords: ['Ú¯Ø§ÙˆØ²Ø¨Ø§Ù†', 'Ø³Ù†Ø¨Ù„', 'Ø¨Ù‡Ø§Ø±Ù†Ø§Ø±Ù†Ø¬'] }
        ];

        // Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¨Ø§ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†
        document.addEventListener('DOMContentLoaded', () => {
            fetch('products.json')
                .then(res => res.ok ? res.json() : [])
                .then(data => {
                    allProducts = data.length ? data : fallbackProducts;
                    initApp();
                })
                .catch(() => {
                    console.log("Error loading JSON, using fallback.");
                    allProducts = fallbackProducts;
                    initApp();
                });
        });

        function initApp() {
            updateFavoritesMenu();
            renderAilmentButtons();
            updateCartAndButton();
            checkSpinStatus();
            
            // Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ú©Ø§Ø´ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
            document.querySelectorAll('.category-tile[data-category]').forEach(tile => {
                tile.addEventListener('click', function() {
                    const cat = this.dataset.category;
                    const name = this.querySelector('h2').innerText;
                    const filtered = allProducts.filter(p => p.category === cat);
                    renderProductList(filtered, name);
                });
            });
        }

        // Ù†Ø§ÙˆØ¨Ø±ÛŒ Ø³Ø§Ø¯Ù‡ Ùˆ Ø§ÛŒÙ…Ù†
        window.navigate = function(target) {
            document.getElementById('category-view').style.display = 'none';
            document.querySelectorAll('.inner-section').forEach(el => el.style.display = 'none');
            
            if (target === 'home') {
                document.getElementById('category-view').style.display = 'block';
            } else {
                const el = document.getElementById(target + '-view');
                if (el) el.style.display = 'block';
            }
            window.scrollTo(0, 0);
        }

        function renderProductList(products, title) {
            const list = document.getElementById('product-list');
            document.getElementById('category-title').innerText = title;
            list.innerHTML = '';

            if(products.length === 0) {
                list.innerHTML = '<p style="text-align:center;">Ù…Ø­ØµÙˆÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>';
            }

            products.forEach(p => {
                const inCart = shoppingCart.find(i => i.name === p.name);
                const div = document.createElement('div');
                div.className = `product-item ${inCart ? 'selected' : ''}`;
                
                div.innerHTML = `
                    <div style="display:flex; align-items:center;">
                        <input type="checkbox" class="product-checkbox" ${inCart ? 'checked' : ''}>
                        <div style="margin-right:10px;">
                            <div style="font-weight:bold;">${p.name}</div>
                            <div style="font-size:0.8rem; color:#888;">${p.unit}</div>
                        </div>
                    </div>
                    ${inCart ? `
                    <div class="quantity-input-container">
                        <div class="delete-btn"><i class="fa-solid fa-trash"></i></div>
                        <input type="number" class="quantity-input" value="${inCart.quantity}">
                    </div>` : ''}
                `;
                
                // Event Listeners without inline complexity
                const checkbox = div.querySelector('.product-checkbox');
                checkbox.addEventListener('change', (e) => {
                    if(e.target.checked) {
                        addToCart(p.name, 1, p.unit);
                        div.classList.add('selected');
                        // Re-render to show input
                        renderProductList(products, title); 
                    } else {
                        removeFromCart(p.name);
                        div.classList.remove('selected');
                        renderProductList(products, title);
                    }
                });
                
                if(inCart) {
                    div.querySelector('.quantity-input').addEventListener('input', (e) => addToCart(p.name, e.target.value, p.unit));
                    div.querySelector('.delete-btn').addEventListener('click', () => {
                        removeFromCart(p.name);
                        renderProductList(products, title);
                    });
                }

                list.appendChild(div);
            });
            navigate('product');
        }

        function addToCart(name, qty, unit) {
            const existing = shoppingCart.find(i => i.name === name);
            if (existing) existing.quantity = qty;
            else shoppingCart.push({name, quantity: qty, unit, type:'std'});
            saveCart();
        }

        function removeFromCart(name) {
            shoppingCart = shoppingCart.filter(i => i.name !== name);
            saveCart();
        }

        function saveCart() {
            localStorage.setItem('senjedCart', JSON.stringify(shoppingCart));
            updateCartAndButton();
        }

        function updateCartAndButton() {
            const count = shoppingCart.length;
            document.getElementById('cart-counter').innerText = count;
            const btn = document.getElementById('whatsapp-button');
            if(count > 0) {
                btn.style.display = 'flex';
                btn.classList.add('visible');
                btn.href = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(generateCartText())}`;
            } else {
                btn.style.display = 'none';
                btn.classList.remove('visible');
            }
        }

        function generateCartText() {
            let txt = "Ø³Ù„Ø§Ù…ØŒ Ø³ÙØ§Ø±Ø´ Ù…Ù†:\n";
            shoppingCart.forEach(i => {
                if(i.type === 'mix') txt += `ğŸ§ª ${i.name} (${i.details})\n`;
                else txt += `â–ªï¸ ${i.name}: ${i.quantity} ${i.unit}\n`;
            });
            return txt;
        }

        // Ø¬Ø³ØªØ¬Ùˆ
        document.getElementById('search-input').addEventListener('input', (e) => {
            const term = e.target.value.trim();
            if(term.length > 1) {
                const res = allProducts.filter(p => p.name.includes(term));
                renderProductList(res, `Ù†ØªØ§ÛŒØ¬: ${term}`);
            } else if (term.length === 0) {
                navigate('home');
            }
        });

        // Ù…Ù†ÙˆÛŒ Ø¬Ø§Ù†Ø¨ÛŒ
        window.toggleMenu = function() {
            document.getElementById('sideMenu').classList.toggle('active');
            document.getElementById('menuOverlay').classList.toggle('active');
        }

        // Ú¯Ø±Ø¯ÙˆÙ†Ù‡
        window.checkSpinStatus = function() {
            if(localStorage.getItem('senjed_wheel_used')) {
                const btn = document.querySelector('.spin-btn');
                if(btn) { btn.disabled = true; btn.innerText = "Ù¾Ø§ÛŒØ§Ù†"; btn.style.background="#ccc"; }
            }
        }
        window.spinWheel = function() {
            if(localStorage.getItem('senjed_wheel_used')) return;
            const wheel = document.getElementById('lucky-wheel');
            const deg = 3600 + Math.random() * 360; 
            wheel.style.transform = `rotate(${deg}deg)`;
            localStorage.setItem('senjed_wheel_used', 'true');
            setTimeout(() => { alert('Ø´Ø§Ù†Ø³ Ø´Ù…Ø§ Ø§Ù…ØªØ­Ø§Ù† Ø´Ø¯!'); checkSpinStatus(); }, 4500);
        }

        // Ù…ÛŒÚ©Ø³Ø± Ø³Ø§Ø¯Ù‡ Ø´Ø¯Ù‡
        window.initMixer = function() {
            const shelf = document.getElementById('shelf');
            if(shelf.children.length > 0) return;
            const colors = ['#e74c3c', '#3498db', '#f1c40f', '#2ecc71', '#9b59b6'];
            for(let i=0; i<5; i++) {
                const d = document.createElement('div');
                d.className = 'supplement-jar';
                d.style.background = colors[i];
                d.innerText = `Ù…Ú©Ù…Ù„ ${i+1}`;
                d.onclick = () => addMixLayer(colors[i], `Ù…Ú©Ù…Ù„ ${i+1}`); // Ú©Ù„ÛŒÚ© Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ù‡ØªØ± Ø§Ø³Øª
                shelf.appendChild(d);
            }
        }

        let mixWeight = 0;
        let mixItems = [];
        function addMixLayer(color, name) {
            if(mixWeight >= 1000) {
                if(confirm('Ø¸Ø±Ù Ù¾Ø± Ø´Ø¯. Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ØŸ')) {
                    shoppingCart.push({name:`Ù…ÛŒÚ©Ø³ Ø§Ø®ØªØµØ§ØµÛŒ ${Date.now()}`, quantity:1, unit:'Ø¹Ø¯Ø¯', type:'mix', details: mixItems.join(', ')});
                    saveCart();
                    mixWeight=0; mixItems=[];
                    document.getElementById('flask-content').innerHTML='';
                    document.getElementById('current-weight').innerText='0g';
                }
                return;
            }
            mixWeight += 200;
            mixItems.push(name);
            const l = document.createElement('div');
            l.style.height = '20%'; l.style.background = color; l.className = 'powder-layer';
            document.getElementById('flask-content').appendChild(l);
            document.getElementById('current-weight').innerText = mixWeight + 'g';
        }

        function renderAilmentButtons() {
            const g = document.getElementById('ailment-grid');
            ailments.forEach(a => {
                const b = document.createElement('div');
                b.className = 'remedy-btn';
                b.innerText = a.name;
                b.onclick = () => {
                    const res = allProducts.filter(p => a.keywords.some(k => p.name.includes(k)));
                    renderProductList(res, `Ø¯Ø±Ù…Ø§Ù† ${a.name}`);
                };
                g.appendChild(b);
            });
        }
        
        function updateFavoritesMenu() {
            // Ø³Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø®Ø·Ø§
            const list = document.getElementById('favoritesList');
            if(favorites.length) list.innerHTML = favorites.join('<br>');
            else list.innerHTML = 'Ø®Ø§Ù„ÛŒ';
        }
        
        window.sendSpecialRequest = function() {
             const name = document.getElementById('special-name').value;
             if(name) window.location.href = `https://wa.me/${whatsappNumber}?text=Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø®Ø§Øµ: ${name}`;
        }

    </script>
</body>
</html>
