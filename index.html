<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لیست محصولات</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
        }
        .category-title {
            background-color: #e9ecef;
            padding: 0.75rem 1.25rem;
            margin-top: 1.5rem;
            border-radius: 0.375rem;
            font-weight: bold;
        }
        /* --- سبک اصلاح شده برای بازگرداندن طرح اصلی --- */
        .product-item {
            display: flex;
            justify-content: space-between; /* کلید اصلی برای چیدمان صحیح */
            align-items: center;
            padding-top: 1rem;
            padding-bottom: 1rem;
        }
        .product-info {
            display: flex;
            align-items: center;
            gap: 0.75rem; /* فاصله بین نام و چک‌باکس */
        }
        .product-info .form-check-label {
            cursor: pointer;
        }
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .quantity-input {
            width: 70px;
            text-align: center;
        }
        .product-unit {
            color: #6c757d;
            font-size: 0.9em;
        }
        .order-btn-container {
            position: sticky;
            bottom: 0;
            background: linear-gradient(to top, white, rgba(255, 255, 255, 0));
            padding: 1.5rem 0;
            border-top: 1px solid #dee2e6;
        }
    </style>
</head>
<body>

    <div class="container py-4">
        <header class="text-center mb-4">
            <h1>لیست محصولات</h1>
            <p class="lead">محصولات مورد نظر خود را انتخاب و مقدار آن را مشخص کنید.</p>
        </header>

        <!-- بخش جستجو (دست نخورده و سالم) -->
        <div class="mb-4">
            <input type="text" id="search-input" class="form-control" placeholder="جستجوی محصول...">
        </div>

        <div id="product-list">
            <!-- محصولات به صورت پویا اینجا بارگذاری می‌شوند -->
        </div>
    </div>

    <div class="order-btn-container text-center">
        <button id="send-order-btn" class="btn btn-success btn-lg">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-whatsapp" viewBox="0 0 16 16">
                <path d="M13.601 2.326A7.85 7.85 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.9 7.9 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.9 7.9 0 0 0 13.6 2.326zM7.994 14.521a6.6 6.6 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.56 6.56 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592m3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.73.73 0 0 0-.529.247c-.182.198-.691.677-.691 1.654s.71 1.916.81 2.049c.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232"/>
            </svg>
            ارسال سفارش به واتس‌اپ
        </button>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const productListEl = document.getElementById('product-list');
        const sendOrderBtn = document.getElementById('send-order-btn');
        const searchInput = document.getElementById('search-input');
        
        let allProductsData = [];

        function displayProducts(searchTerm = '') {
            productListEl.innerHTML = '';
            const lowercasedSearchTerm = searchTerm.trim().toLowerCase();

            let availableProducts = allProductsData.filter(p => p.available);
            
            if (lowercasedSearchTerm) {
                availableProducts = availableProducts.filter(p => 
                    p.name.toLowerCase().includes(lowercasedSearchTerm)
                );
            }

            if (availableProducts.length === 0 && lowercasedSearchTerm) {
                productListEl.innerHTML = `<p class="text-center text-muted mt-4">محصولی با این نام یافت نشد.</p>`;
                return;
            }
            if (availableProducts.length === 0) {
                 productListEl.innerHTML = `<p class="text-center text-muted mt-4">در حال حاضر محصولی برای نمایش وجود ندارد.</p>`;
                return;
            }

            const groupedByCategory = availableProducts.reduce((acc, product) => {
                const category = product.category || 'متفرقه';
                if (!acc[category]) {
                    acc[category] = [];
                }
                acc[category].push(product);
                return acc;
            }, {});

            for (const category in groupedByCategory) {
                const categoryTitle = document.createElement('h2');
                categoryTitle.className = 'h4 category-title';
                categoryTitle.textContent = category;
                productListEl.appendChild(categoryTitle);

                const productGroup = document.createElement('ul');
                productGroup.className = 'list-group list-group-flush';
                
                groupedByCategory[category].forEach(product => {
                    const listItem = document.createElement('li');
                    listItem.className = 'list-group-item product-item';
                    
                    // --- ساختار HTML اصلاح شده برای بازگرداندن طرح اصلی ---
                    listItem.innerHTML = `
                        <div class="product-info">
                            <input class="form-check-input" type="checkbox" value="" id="product-${product.id}" data-product-id="${product.id}" data-product-name="${product.name}" data-product-unit="${product.unit || ''}">
                            <label class="form-check-label" for="product-${product.id}">
                                ${product.name}
                            </label>
                        </div>
                        <div class="quantity-control">
                            <span class="product-unit">${product.unit || ''}</span>
                            <input type="number" class="form-control quantity-input" id="quantity-${product.id}" value="1" min="1" disabled>
                        </div>
                    `;
                    productGroup.appendChild(listItem);
                });
                
                productListEl.appendChild(productGroup);
            }
        }

        productListEl.addEventListener('change', (e) => {
            if (e.target.type === 'checkbox') {
                const productId = e.target.dataset.productId;
                const quantityInput = document.getElementById(`quantity-${productId}`);
                quantityInput.disabled = !e.target.checked;
            }
        });

        sendOrderBtn.addEventListener('click', () => {
            const selectedItems = [];
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            
            checkboxes.forEach(cb => {
                const productId = cb.dataset.productId;
                const name = cb.dataset.productName;
                const unit = cb.dataset.productUnit;
                const quantity = document.getElementById(`quantity-${productId}`).value;
                
                if (parseInt(quantity, 10) > 0) {
                    selectedItems.push(`${name}: ${quantity} ${unit}`);
                }
            });

            if (selectedItems.length === 0) {
                alert('لطفا حداقل یک محصول را انتخاب کنید.');
                return;
            }

            const message = "سلام، لطفا سفارش زیر را آماده کنید:\n\n" + selectedItems.join('\n');
            const phoneNumber = "989918022066"; // شماره واتس‌اپ خود را اینجا وارد کنید
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            
            window.open(whatsappUrl, '_blank');
        });

        searchInput.addEventListener('input', () => {
            displayProducts(searchInput.value);
        });

        fetch('products.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                allProductsData = data;
                displayProducts();
            })
            .catch(error => {
                console.error("خطا در بارگذاری فایل products.json:", error);
                productListEl.innerHTML = `<p class="text-center text-danger">متاسفانه در بارگذاری محصولات مشکلی پیش آمده است. لطفا بعداً تلاش کنید.</p>`;
            });
    });
    </script>
</body>
</html>
