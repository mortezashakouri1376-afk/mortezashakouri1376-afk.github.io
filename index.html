<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø³Ù†Ø¬Ø¯</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Lalezar&family=Vazirmatn:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #6B8E23; 
            --dark-green: #3A5210;
            --light-bg: #f8f9fa;      
            --selected-bg: #eef5e0;   
            --text-color: #444;
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
            --gold-color: #FFD700;
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            margin: 0; padding: 0 0 100px 0;
            background-color: var(--light-bg);
            color: var(--text-color);
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            width: 100vw;
        }

        /* --- Ù‡Ø¯Ø± --- */
        .header {
            position: relative;
            background: linear-gradient(135deg, #557C18 0%, #2d420b 100%);
            padding: 40px 20px 70px 20px;
            border-radius: 0 0 40px 40px;
            text-align: center; overflow: hidden;
            box-shadow: 0 10px 25px rgba(45, 66, 11, 0.3); z-index: 10;
        }
        .header-bg-icon {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 10rem; color: rgba(255,255,255,0.03); pointer-events: none;
        }
        .header h1 {
            font-family: 'Lalezar', cursive; margin: 0; font-size: 3.5rem; color: #fff;
            text-shadow: 0 4px 15px rgba(0,0,0,0.3); position: relative; z-index: 2;
            animation: fadeInDown 1s ease-out;
        }
        .header p {
            font-weight: 300; margin: 5px 0 0; 
            color: rgba(255, 255, 255, 0.85); font-size: 1rem; position: relative; z-index: 2;
            animation: fadeInUp 1s ease-out 0.3s backwards;
        }
        
        .menu-toggle-btn {
            position: absolute; top: 20px; right: 20px;
            background: none; border: none; color: white; font-size: 1.8rem;
            cursor: pointer; z-index: 20; padding: 5px;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ */
        button:focus, input:focus, .product-item:focus-within, .category-tile:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(107, 142, 35, 0.3);
        }

        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .container { padding: 0 20px 20px; max-width: 1200px; margin: 0 auto; }
        
        /* --- Ø¬Ø³ØªØ¬Ùˆ Ùˆ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† --- */
        .search-container { position: relative; margin-top: -35px; margin-bottom: 35px; z-index: 20; }
        #search-input {
            width: 100%; padding: 18px 50px 18px 50px; font-size: 1.1rem;
            border-radius: 50px; border: none;
            background-color: #fff; box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            color: #555; box-sizing: border-box; transition: all 0.3s ease;
        }
        .search-icon { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: var(--primary-color); font-size: 1.2rem; pointer-events: none; }
        
        .mic-icon {
            position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
            color: #888; font-size: 1.2rem; cursor: pointer;
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
            border-radius: 50%; transition: all 0.3s;
        }
        .mic-icon:hover { background: #eee; color: var(--primary-color); }
        .mic-icon.listening { 
            color: #fff; background: #ff4757; 
            animation: pulse-red 1.5s infinite;
        }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(255, 71, 87, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 71, 87, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 71, 87, 0); }
        }

        /* --- Ù…Ù†ÙˆÛŒ Ø¬Ø§Ù†Ø¨ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ --- */
        .side-menu-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4); z-index: 998;
            opacity: 0; visibility: hidden; transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }
        .side-menu {
            position: fixed; top: 0; right: -320px;
            width: 280px; height: 100%;
            background: linear-gradient(180deg, #1a2e12 0%, #0f1a0a 100%);
            z-index: 999; box-shadow: -5px 0 20px rgba(0,0,0,0.3);
            padding: 0; display: flex; flex-direction: column; color: white;
            visibility: hidden; 
            transition: right 0.4s cubic-bezier(0.19,1,0.22,1), visibility 0s linear 0.4s;
            overflow-y: auto;
        }
        .side-menu.active { 
            right: 0; visibility: visible;
            transition: right 0.4s cubic-bezier(0.19,1,0.22,1), visibility 0s linear 0s;
        }
        .side-menu-overlay.active { opacity: 1; visibility: visible; }

        .side-menu-header {
            padding: 25px; background: rgba(255,255,255,0.05);
            display: flex; justify-content: space-between; align-items: center;
        }
        .menu-items { list-style: none; padding: 0; margin: 0; }
        .menu-items li { border-bottom: 1px solid rgba(255,255,255,0.05); }
        .menu-btn {
            width: 100%; text-align: right; background: none; border: none;
            color: #eee; padding: 15px 25px; font-size: 1rem;
            font-family: 'Vazirmatn'; cursor: pointer; display: flex; align-items: center; gap: 15px;
            transition: background 0.2s;
        }
        .menu-btn:hover { background: rgba(255,255,255,0.05); color: var(--gold-color); }
        
        /* --- Ú©Ø§Ø´ÛŒâ€ŒÙ‡Ø§ --- */
        .categories-grid { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(140px,1fr)); gap: 15px; padding-bottom: 20px;
        }
        @media (min-width:480px) { .categories-grid { grid-template-columns: repeat(auto-fill,minmax(200px,1fr)); gap:20px; } }

        .category-tile {
            position: relative; color: white; border-radius: 25px; overflow: hidden;
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            height: 160px; padding: 10px; box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s cubic-bezier(0.25,0.8,0.25,1); cursor: pointer;
        }
        .category-tile:active { transform: scale(0.96); }
        .category-tile:hover { transform: translateY(-5px); }

        .cat-special { background: linear-gradient(135deg,#232526 0%,#414345 100%); border:1px solid rgba(255,255,255,0.2); }
        .cat-mixer { background: linear-gradient(135deg,#8E2DE2 0%,#4A00E0 100%); box-shadow:0 10px 20px rgba(74,0,224,0.3); }
        .cat-herbs { background: linear-gradient(135deg,#56ab2f 0%,#a8e063 100%); }
        .cat-spices { background: linear-gradient(135deg,#ff512f 0%,#dd2476 100%); }
        .cat-liquids { background: linear-gradient(135deg,#4facfe 0%,#00f2fe 100%); }
        .cat-oils { background: linear-gradient(135deg,#f09819 0%,#edde5d 100%); }
        .cat-grains { background: linear-gradient(135deg,#EB3349 0%,#F45C43 100%); }
        .cat-hygiene { background: linear-gradient(135deg,#11998e 0%,#38ef7d 100%); }
        .cat-food { background: linear-gradient(135deg,#FF8008 0%,#FFC837 100%); }
        .cat-misc { background: linear-gradient(135deg,#6190E8 0%,#A7BFE8 100%); }

        .tile-content { position: relative; z-index: 2; text-align: center; width:100%; }
        .tile-content i { font-size: 2.8rem; margin-bottom: 10px; color: #fff; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.2)); }
        .tile-content h2 { font-family: 'Lalezar', cursive; margin:0; font-size:1.3rem; text-shadow:0 2px 5px rgba(0,0,0,0.2); }

        /* --- Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ÛŒ --- */
        .inner-section { display: none; margin-top: 20px; background-color: white; padding:25px; border-radius:25px; box-shadow:var(--shadow); }
        .back-btn { 
            background-color: #f0f2f5; color: #555; border:none; padding:10px 20px; 
            border-radius:15px; cursor:pointer; font-family:'Vazirmatn'; font-weight:700;
            margin-bottom:20px; display:inline-flex; align-items:center; gap:8px;
        }

        /* --- Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª --- */
        .product-list { list-style:none; padding:0; margin:0; }
        .product-item {
            display:grid; grid-template-columns:auto auto 1fr auto; gap:10px;
            align-items:center; padding:15px 10px; border-bottom:1px solid #f4f4f4;
            transition:background-color 0.2s; border-radius:12px; margin-bottom:5px;
            user-select: none;
        }
        .product-item.selected { background-color:var(--selected-bg); border:1px solid var(--primary-color); }
        .product-checkbox { width:24px; height:24px; accent-color:var(--primary-color); }
        
        .star-btn {
            background:none; border:none; cursor:pointer; font-size:1.2rem; color:#ccc;
            transition:all 0.3s ease; padding:5px;
        }
        .star-btn.active { color:var(--gold-color); animation: starPop 0.3s ease; }
        @keyframes starPop { 0% { transform: scale(1); } 50% { transform: scale(1.4); } 100% { transform: scale(1); } }

        .quantity-input-container { display:none; align-items:center; gap:10px; }
        .product-item.selected .quantity-input-container { display:flex; }
        .quantity-input { width:50px; padding:5px; border:2px solid #dce6c5; border-radius:10px; text-align:center; font-weight:bold; color:var(--primary-color); }
        .delete-btn { color:#ff4757; background:#ffeef0; border-radius:10px; width:32px; height:32px; display:flex; align-items:center; justify-content:center; cursor:pointer; }

        /* ========================================= */
        /* !!! Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯Ù‡ Ù…ÛŒÚ©Ø³Ø± !!! */
        /* ========================================= */
        .mixer-wrapper { display:flex; flex-direction:column; align-items:center; gap:20px; }
        .size-selector {
            display:flex; background:#eee; padding:5px; border-radius:50px; width:100%; max-width:350px; margin-bottom:10px;
        }
        .size-btn {
            flex:1; border:none; background:transparent; padding:10px; border-radius:40px; cursor:pointer; font-family:'Lalezar'; font-size:1rem; color:#666;
            transition:all 0.3s ease;
        }
        .size-btn.active { background:#fff; color:#8E2DE2; box-shadow:0 2px 10px rgba(0,0,0,0.1); transform:scale(1.05); }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ù‚ÙØ³Ù‡ Ùˆ Ù‚ÙˆØ·ÛŒâ€ŒÙ‡Ø§ Ù…Ø·Ø§Ø¨Ù‚ Ú©Ø¯ Ù‚Ø¯ÛŒÙ…ÛŒ */
        .supplements-shelf {
            display:grid; grid-template-columns:repeat(5,1fr); gap:8px;
            background:#8B5E3C; padding:15px 10px 25px 10px; border-radius:15px; width:100%; position:relative;
            box-shadow:inset 0 10px 20px rgba(0,0,0,0.4),0 5px 15px rgba(0,0,0,0.2);
            border-bottom:8px solid #5D3A1A;
        }
        .supplement-jar {
            background:linear-gradient(to right,rgba(255,255,255,0.8),rgba(255,255,255,0.5));
            border-radius:5px; height:55px; display:flex; flex-direction:column; align-items:center;
            cursor:grab; position:relative; box-shadow:0 5px 5px rgba(0,0,0,0.2);
            transition:transform 0.1s;
        }
        .supplement-jar:active { transform:scale(0.9); cursor:grabbing; }
        .jar-lid { width:70%; height:6px; background:#333; margin-top:-3px; border-radius:2px; }
        .jar-body { width:100%; height:100%; border-radius:5px; display:flex; align-items:center; justify-content:center; }
        .jar-body span { font-size:0.6rem; font-weight:bold; color:rgba(0,0,0,0.6); writing-mode:vertical-rl; transform:rotate(180deg); }

        .mixing-area {
            position:relative; width:100%; height:260px;
            display:flex; justify-content:center; align-items:flex-end;
        }
        .flask-container {
            position:relative; width:160px; height:220px;
            display:flex; flex-direction:column-reverse; align-items:center;
        }
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø§Ù„Ù† Ø¢Ø²Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ */
        .flask-glass {
            position:relative; width:100%; height:100%;
            background:rgba(255,255,255,0.1);
            border:4px solid rgba(255,255,255,0.6);
            border-top:none;
            border-radius:0 0 20px 20px;
            clip-path:polygon(20% 0,80% 0,100% 100%,0% 100%);
            overflow:hidden; z-index:2; backdrop-filter:blur(2px);
            box-shadow:inset 0 -10px 20px rgba(255,255,255,0.3),0 10px 20px rgba(0,0,0,0.1);
        }
        .flask-neck {
            position:absolute; top:-35px; left:50%; transform:translateX(-50%);
            width:50px; height:40px; background:rgba(255,255,255,0.1);
            border:4px solid rgba(255,255,255,0.6); border-bottom:none; border-radius:5px 5px 0 0;
            z-index:1;
        }
        .powder-layer { width:100%; transition:height 0.4s cubic-bezier(0.4,2,0.55,0.44); border-top:1px solid rgba(255,255,255,0.2); }
        
        .particle {
            position:absolute; top:0; width:6px; height:6px; border-radius:50%;
            animation: fall 0.6s linear forwards; z-index:5; pointer-events:none;
        }
        @keyframes fall {
            0% { transform: translateY(0) scale(1); opacity:1; }
            100% { transform: translateY(150px) scale(0.5); opacity:0; }
        }
        .flask-stats {
            position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
            font-size:1.8rem; font-weight:bold; color:#333; text-shadow:0 0 10px rgba(255,255,255,0.8);
            z-index:10; pointer-events:none; font-family:'Lalezar', cursive;
            background:rgba(255,255,255,0.6); padding:5px 15px; border-radius:20px;
        }
        .completed-mixes { width:100%; border-top:2px dashed #ddd; padding-top:15px; margin-top:15px; }
        .mix-item {
            background:white; padding:10px; border-radius:12px; margin-bottom:8px;
            display:flex; justify-content:space-between; align-items:center;
            box-shadow:0 2px 5px rgba(0,0,0,0.05);
        }
        .delete-mix-btn { color:red; background:#ffeeee; border:none; padding:5px 10px; border-radius:8px; cursor:pointer; }

        /* --- ÙˆØ§ØªØ³â€ŒØ§Ù¾ --- */
        .whatsapp-fab {
            position:fixed; bottom:25px; left:25px; 
            background:linear-gradient(135deg,#25D366,#128C7E);
            color:white; width:65px; height:65px; border-radius:50%; display:flex;
            justify-content:center; align-items:center; font-size:2.5rem;
            box-shadow:0 10px 25px rgba(37,211,102,0.3); text-decoration:none;
            transform:scale(0); transition:all 0.4s; cursor:pointer; z-index:1000;
        }
        .whatsapp-fab.visible { transform:scale(1); }
        .cart-counter {
            position:absolute; top:0; right:0; background-color:#ff4757;
            color:white; border-radius:50%; width:24px; height:24px;
            font-size:0.8rem; font-weight:bold; display:flex; justify-content:center; align-items:center; border:2px solid white;
        }

        /* --- Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§ --- */
        .modal-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.6); z-index: 2000;
            display: none; justify-content: center; align-items: center;
            backdrop-filter: blur(5px); padding: 20px; box-sizing: border-box;
        }
        .modal-content {
            background: white; width: 100%; max-width: 400px;
            border-radius: 25px; padding: 25px; position: relative;
            text-align: center; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .close-modal { position: absolute; top: 15px; left: 15px; font-size: 1.5rem; cursor: pointer; color: #888; }

        /* --- Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³ --- */
        .wheel-container { width: 250px; height: 250px; margin: 0 auto 20px; position: relative; }
        .wheel {
            width: 100%; height: 100%; border-radius: 50%; border: 5px solid #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            background: conic-gradient(
                #ff6b6b 0deg 60deg,
                #4ecdc4 60deg 120deg,
                #ffe66d 120deg 180deg,
                #ff9f43 180deg 240deg,
                #54a0ff 240deg 300deg,
                #5f27cd 300deg 360deg
            );
            transition: transform 4s cubic-bezier(0.1, 0.7, 0.1, 1);
        }
        .wheel-arrow {
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 30px solid #333; z-index: 5;
        }
        .spin-btn { background: var(--primary-color); color: white; padding: 10px 30px; border: none; border-radius: 50px; font-size: 1.2rem; cursor: pointer; margin-top: 15px; font-family: 'Lalezar'; }

        /* --- Ø·Ø¨ÛŒØ¨ Ø³Ù†Ø¬Ø¯ --- */
        .remedy-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: center; }
        .remedy-btn {
            padding: 15px; background: #f0f2f5; border-radius: 15px; cursor: pointer; transition: 0.2s;
        }
        .remedy-btn:hover { background: #e0e7d0; color: var(--dark-green); }
        .remedy-icon { font-size: 2rem; display: block; margin-bottom: 5px; }

        /* --- Ø¯Ø±Ú¯ (Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ø´Ø¯Ù‡ Ø¨Ù‡ Ø­Ø§Ù„Øª Ù‚Ø¨Ù„) --- */
        .drag-ghost {
            position:fixed; pointer-events:none; z-index:9999; width:50px; height:50px;
            opacity:0.9; border-radius:50%; box-shadow:0 10px 20px rgba(0,0,0,0.3);
            display:none; align-items:center; justify-content:center; font-size:20px;
            color:white; font-weight:bold; border:2px solid white;
        }

    </style>
</head>
<body>

    <header class="header">
        <button class="menu-toggle-btn" aria-label="Ù…Ù†Ùˆ" onclick="toggleMenu()"><i class="fa-solid fa-bars"></i></button>
        <i class="fa-solid fa-leaf header-bg-icon"></i>
        <h1>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø³Ù†Ø¬Ø¯</h1>
        <p>Ø·Ø¨ÛŒØ¹Øª Ø±Ø§ Ø¨Ù‡ Ø®Ø§Ù†Ù‡ Ø®ÙˆØ¯ Ø¨ÛŒØ§ÙˆØ±ÛŒØ¯</p>
    </header>

    <!-- Ù…Ù†ÙˆÛŒ Ù‡Ù…Ø¨Ø±Ú¯Ø±ÛŒ Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ -->
    <div class="side-menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>
    <div class="side-menu" id="sideMenu">
        <div class="side-menu-header">
            <h3 style="margin:0; font-family:'Lalezar'; font-size:1.5rem; color:var(--gold-color)">Ù…Ù†ÙˆÛŒ Ø§Ù…Ú©Ø§Ù†Ø§Øª</h3>
            <button style="background:none; border:none; color:white; font-size:1.5rem;" onclick="toggleMenu()">Ã—</button>
        </div>
        
        <ul class="menu-items">
            <li>
                <button class="menu-btn" onclick="openModal('remedyModal'); toggleMenu()">
                    <i class="fa-solid fa-user-doctor" style="color:#4ecdc4"></i> Ø·Ø¨ÛŒØ¨ Ø³Ù†Ø¬Ø¯
                </button>
            </li>
            <li>
                <button class="menu-btn" onclick="openModal('wheelModal'); toggleMenu()">
                    <i class="fa-solid fa-dharmachakra" style="color:#ff9f43"></i> Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³
                </button>
            </li>
            <li>
                <button class="menu-btn" onclick="alert('Ø¨Ø±Ø§ÛŒ Ù†ØµØ¨: Ø±ÙˆÛŒ Ù…Ù†ÙˆÛŒ Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø²Ù†ÛŒØ¯ Ùˆ Install App ÛŒØ§ Add to Home Screen Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.');">
                    <i class="fa-brands fa-android" style="color:#a8e063"></i> Ù†ØµØ¨ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†
                </button>
            </li>
            <li>
                <div style="padding: 15px 25px; color: rgba(255,255,255,0.6); font-size: 0.9rem;">Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§:</div>
                <div id="favoritesList" style="max-height: 30vh; overflow-y: auto; padding: 0 25px;"></div>
            </li>
        </ul>
    </div>

    <div class="container">
        <!-- Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø§ Ù…ÛŒÚ©Ø±ÙˆÙÙˆÙ† -->
        <div class="search-container">
            <div class="mic-icon" id="mic-btn" onclick="startVoiceSearch()">
                <i class="fa-solid fa-microphone"></i>
            </div>
            <i class="fa-solid fa-search search-icon"></i>
            <input type="search" id="search-input" placeholder="Ø¬Ø³ØªØ¬Ùˆ ÛŒØ§ Ú¯ÙØªØ§Ø±..." autocomplete="off">
        </div>

        <div id="category-view">
            <div class="categories-grid">
                <div class="category-tile cat-special" onclick="showSection('special-request-view')">
                    <div class="tile-content"><i class="fa-solid fa-star"></i><h2>Ø³ÙØ§Ø±Ø´ Ù…Ø­ØµÙˆÙ„ Ø®Ø§Øµ</h2></div>
                </div>
                <div class="category-tile cat-mixer" onclick="initMixer(); showSection('mixer-view')">
                    <div class="tile-content"><i class="fa-solid fa-flask"></i><h2>Ù…ÛŒÚ©Ø³ Ù…Ú©Ù…Ù„ (Ø¯Ù„Ø®ÙˆØ§Ù‡)</h2></div>
                </div>
                <!-- Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ -->
                <div class="category-tile cat-herbs" data-category="Ú¯ÛŒØ§Ù‡Ø§Ù†-Ø¯Ø§Ø±ÙˆÛŒÛŒ"><div class="tile-content"><i class="fa-solid fa-leaf"></i><h2>Ú¯ÛŒØ§Ù‡Ø§Ù† Ø¯Ø§Ø±ÙˆÛŒÛŒ</h2></div></div>
                <div class="category-tile cat-spices" data-category="Ø§Ø¯ÙˆÛŒÙ‡-Ø¬Ø§Øª"><div class="tile-content"><i class="fa-solid fa-mortar-pestle"></i><h2>Ø§Ø¯ÙˆÛŒÙ‡â€ŒØ¬Ø§Øª</h2></div></div>
                <div class="category-tile cat-liquids" data-category="Ø¹Ø±Ù‚ÛŒØ§Øª"><div class="tile-content"><i class="fa-solid fa-bottle-droplet"></i><h2>Ø¹Ø±Ù‚ÛŒØ§Øª</h2></div></div>
                <div class="category-tile cat-oils" data-category="Ø±ÙˆØºÙ†-Ù‡Ø§"><div class="tile-content"><i class="fa-solid fa-oil-well"></i><h2>Ø±ÙˆØºÙ†â€ŒÙ‡Ø§</h2></div></div>
            </div>
        </div>

        <div id="product-view" class="inner-section">
            <button class="back-btn" onclick="showCategoryView()"><i class="fa-solid fa-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            <h2 id="product-category-title" style="color:var(--primary-color); font-family:'Lalezar';"></h2>
            <p style="font-size:0.8rem; color:#888; text-align:center; margin-bottom:10px;">ğŸ’¡ Ù†Ú©ØªÙ‡: Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø®ÙˆØ§Øµ Ù…Ø­ØµÙˆÙ„ØŒ Ø§Ù†Ú¯Ø´Øª Ø®ÙˆØ¯ Ø±Ø§ Ø±ÙˆÛŒ Ø¢Ù† Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯.</p>
            <div id="loading">Ø¯Ø±Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
            <ul id="product-list" class="product-list"></ul>
        </div>

        <!-- ÙØ±Ù… Ø³ÙØ§Ø±Ø´ Ø®Ø§Øµ -->
        <div id="special-request-view" class="inner-section">
            <button class="back-btn" onclick="showCategoryView()"><i class="fa-solid fa-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            <h2 style="font-family:'Lalezar'; color:#203a43;">Ø³ÙØ§Ø±Ø´ Ù…Ø­ØµÙˆÙ„ Ú©Ù…ÛŒØ§Ø¨</h2>
            <div style="display:flex; flex-direction:column; gap:15px;">
                <input type="text" id="special-name" style="padding:15px; border:2px solid #eee; border-radius:15px;" placeholder="Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„">
                <input type="text" id="special-details" style="padding:15px; border:2px solid #eee; border-radius:15px;" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª">
                <button onclick="sendSpecialRequest()" style="background:#203a43; color:white; padding:15px; border:none; border-radius:15px;">Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª</button>
            </div>
        </div>

        <!-- Ù…ÛŒÚ©Ø³Ø± (Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯Ù‡ Ø¨Ù‡ Ø³Ø§Ø®ØªØ§Ø± Ù‚Ø¯ÛŒÙ…ÛŒ) -->
        <div id="mixer-view" class="inner-section" style="background:#fff9fc;">
            <button class="back-btn" onclick="showCategoryView()"><i class="fa-solid fa-arrow-right"></i> Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            
            <div class="mixer-wrapper">
                <h2 style="font-family:'Lalezar'; color:#8E2DE2; margin:0;">Ø¢Ø²Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ Ù…Ú©Ù…Ù„</h2>
                
                <div class="size-selector">
                    <button class="size-btn" onclick="setMixerSize(500,50,this)">Ù†ÛŒÙ… Ú©ÛŒÙ„Ùˆ</button>
                    <button class="size-btn active" onclick="setMixerSize(1000,100,this)">ÛŒÚ© Ú©ÛŒÙ„Ùˆ</button>
                    <button class="size-btn" onclick="setMixerSize(5000,250,this)">Ù¾Ù†Ø¬ Ú©ÛŒÙ„Ùˆ</button>
                </div>

                <div class="supplements-shelf" id="shelf"></div>

                <div class="mixing-area">
                    <div class="flask-container" id="flask-target">
                        <div class="flask-neck"></div>
                        <div class="flask-glass" id="flask-content"></div>
                        <div class="flask-stats"><span id="current-weight">0</span>g</div>
                    </div>
                </div>

                <div class="completed-mixes">
                    <h4 style="margin:0 0 10px 0; color:#555;">ØªØ±Ú©ÛŒØ¨â€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø±Ø³Ø§Ù„:</h4>
                    <div id="mix-list">
                        <small style="color:#999; display:block; text-align:center;">Ù‡Ù†ÙˆØ² ØªØ±Ú©ÛŒØ¨ÛŒ Ù†Ø³Ø§Ø®ØªÙ‡â€ŒØ§ÛŒØ¯.</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FAB ÙˆØ§ØªØ³â€ŒØ§Ù¾ -->
    <div id="whatsapp-button" class="whatsapp-fab">
        <i class="fab fa-whatsapp"></i>
        <span id="cart-counter" class="cart-counter"></span>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø·Ø¨ÛŒØ¨ Ø³Ù†Ø¬Ø¯ -->
    <div id="remedyModal" class="modal-overlay">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('remedyModal')">&times;</span>
            <h2 style="font-family:'Lalezar'; color:var(--primary-color)">Ø·Ø¨ÛŒØ¨ Ø³Ù†Ø¬Ø¯ ğŸ©º</h2>
            <p>Ú†Ù‡ Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ØªØ§ Ù†Ø³Ø®Ù‡ Ø¨Ù¾ÛŒÚ†Ù…!</p>
            <div class="remedy-grid">
                <div class="remedy-btn" onclick="applyRemedy('Ø³Ø±Ø¯Ø±Ø¯')"><span class="remedy-icon">ğŸ¤•</span>Ø³Ø±Ø¯Ø±Ø¯</div>
                <div class="remedy-btn" onclick="applyRemedy('Ù…Ø¹Ø¯Ù‡')"><span class="remedy-icon">ğŸ¤¢</span>Ù…Ø¹Ø¯Ù‡ Ø¯Ø±Ø¯</div>
                <div class="remedy-btn" onclick="applyRemedy('Ø§Ø¹ØµØ§Ø¨')"><span class="remedy-icon">ğŸ§ </span>Ø¢Ø±Ø§Ù…Ø´ Ø§Ø¹ØµØ§Ø¨</div>
                <div class="remedy-btn" onclick="applyRemedy('Ø³Ø±Ù…Ø§Ø®ÙˆØ±Ø¯Ú¯ÛŒ')"><span class="remedy-icon">ğŸ¤§</span>Ø³Ø±Ù…Ø§Ø®ÙˆØ±Ø¯Ú¯ÛŒ</div>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³ -->
    <div id="wheelModal" class="modal-overlay">
        <div class="modal-content" style="background:#2c3e50; color:white;">
            <span class="close-modal" onclick="closeModal('wheelModal')">&times;</span>
            <h2 style="font-family:'Lalezar'; color:#f1c40f">Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³ ğŸ¡</h2>
            <div class="wheel-container">
                <div class="wheel-arrow"></div>
                <div class="wheel" id="luckyWheel"></div>
            </div>
            <button id="spinBtn" class="spin-btn" onclick="spinWheel()">Ø¨Ú†Ø±Ø®ÙˆÙ†!</button>
            <p id="winResult" style="font-weight:bold; font-size:1.2rem; margin-top:15px; min-height:30px;"></p>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¯Ø§Ù†Ø´Ù†Ø§Ù…Ù‡ (Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø­ØµÙˆÙ„) -->
    <div id="infoModal" class="modal-overlay">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('infoModal')">&times;</span>
            <h2 id="infoTitle" style="font-family:'Lalezar'; color:var(--primary-color)"></h2>
            <div style="font-size:3rem; margin:10px 0;" id="infoIcon"></div>
            <p id="infoDesc" style="color:#666; line-height:1.6;"></p>
            <div style="margin-top:15px; background:#f9f9f9; padding:10px; border-radius:10px;">
                <small>Ø·Ø¨Ø¹: <span id="infoNature" style="font-weight:bold;">Ú¯Ø±Ù… Ùˆ Ø®Ø´Ú©</span></small>
            </div>
        </div>
    </div>

    <div id="drag-ghost" class="drag-ghost"></div>

    <script>
    // Ù…ØªØºÛŒØ± Ø³Ø±Ø§Ø³Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ø¯ ØªØ®ÙÛŒÙ
    let activeDiscount = "";

    document.addEventListener('DOMContentLoaded', function() {
        const whatsappNumber = "989918022066";
        const categoryView = document.getElementById('category-view');
        const productList = document.getElementById('product-list');
        const categoryTitle = document.getElementById('product-category-title');
        const whatsappBtn = document.getElementById('whatsapp-button');
        const cartCounter = document.getElementById('cart-counter');
        const searchInput = document.getElementById('search-input');
        const sideMenu = document.getElementById('sideMenu');
        const menuOverlay = document.getElementById('menuOverlay');
        const favoritesListEl = document.getElementById('favoritesList');

        let allProducts = [
            {name:"Ø¢ÙˆÛŒØ´Ù†", category:"Ú¯ÛŒØ§Ù‡Ø§Ù†-Ø¯Ø§Ø±ÙˆÛŒÛŒ", unit:"Ú¯Ø±Ù…", available:true, desc:"Ø¶Ø¯ Ø³Ø±ÙÙ‡ØŒ ØªÙ‚ÙˆÛŒØª Ø³ÛŒØ³ØªÙ… Ø§ÛŒÙ…Ù†ÛŒ", nature:"Ú¯Ø±Ù… Ùˆ Ø®Ø´Ú©"},
            {name:"Ú¯Ù„â€ŒÚ¯Ø§ÙˆØ²Ø¨Ø§Ù†", category:"Ú¯ÛŒØ§Ù‡Ø§Ù†-Ø¯Ø§Ø±ÙˆÛŒÛŒ", unit:"Ú¯Ø±Ù…", available:true, desc:"Ø¢Ø±Ø§Ù…Ø¨Ø®Ø´ØŒ Ù…Ù‚ÙˆÛŒ Ù‚Ù„Ø¨ Ùˆ Ø§Ø¹ØµØ§Ø¨", nature:"Ú¯Ø±Ù…"},
            {name:"Ø²Ø±Ø¯Ú†ÙˆØ¨Ù‡", category:"Ø§Ø¯ÙˆÛŒÙ‡-Ø¬Ø§Øª", unit:"Ú¯Ø±Ù…", available:true, desc:"Ø¶Ø¯ Ø§Ù„ØªÙ‡Ø§Ø¨ Ù‚ÙˆÛŒØŒ Ø¢Ù†ØªÛŒ Ø§Ú©Ø³ÛŒØ¯Ø§Ù†", nature:"Ú¯Ø±Ù… Ùˆ Ø®Ø´Ú©"},
            {name:"ÙÙ„ÙÙ„ Ø³ÛŒØ§Ù‡", category:"Ø§Ø¯ÙˆÛŒÙ‡-Ø¬Ø§Øª", unit:"Ú¯Ø±Ù…", available:true, desc:"Ø§ÙØ²Ø§ÛŒØ´ Ù…ØªØ§Ø¨ÙˆÙ„ÛŒØ³Ù…ØŒ Ø·Ø¹Ù… Ø¯Ù‡Ù†Ø¯Ù‡", nature:"Ú¯Ø±Ù… Ùˆ Ø®Ø´Ú©"},
            {name:"Ú¯Ù„Ø§Ø¨", category:"Ø¹Ø±Ù‚ÛŒØ§Øª", unit:"Ù„ÛŒØªØ±", available:true, desc:"Ù†Ø´Ø§Ø· Ø¢ÙˆØ±ØŒ Ù…ÙÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù¾ÙˆØ³Øª", nature:"Ù…Ø¹ØªØ¯Ù„"},
            {name:"Ø¹Ø±Ù‚ Ù†Ø¹Ù†Ø§", category:"Ø¹Ø±Ù‚ÛŒØ§Øª", unit:"Ù„ÛŒØªØ±", available:true, desc:"Ø¶Ø¯ Ù†ÙØ®ØŒ Ù…Ù‚ÙˆÛŒ Ù…Ø¹Ø¯Ù‡", nature:"Ú¯Ø±Ù…"},
            {name:"Ø±ÙˆØºÙ† Ø²ÛŒØªÙˆÙ†", category:"Ø±ÙˆØºÙ†-Ù‡Ø§", unit:"Ù„ÛŒØªØ±", available:true, desc:"Ø³Ù„Ø§Ù…Øª Ù‚Ù„Ø¨ØŒ Ú©Ø§Ù‡Ø´ Ú©Ù„Ø³ØªØ±ÙˆÙ„", nature:"Ú¯Ø±Ù…"},
            {name:"Ø¹Ø³Ù„ Ø·Ø¨ÛŒØ¹ÛŒ", category:"Ø®ÙˆØ±Ø§Ú©ÛŒ", unit:"Ú©ÛŒÙ„Ùˆ", available:true, desc:"Ø§Ú©Ø³ÛŒØ± Ø¬ÙˆØ§Ù†ÛŒØŒ Ø¶Ø¯ Ø¨Ø§Ú©ØªØ±ÛŒ", nature:"Ú¯Ø±Ù…"}
        ];
        
        let shoppingCart = [];
        let mixedProducts = [];
        let favorites = JSON.parse(localStorage.getItem('senjedFavorites')) || [];

        /* --- ØªÙˆØ§Ø¨Ø¹ Ù¾Ø§ÛŒÙ‡ --- */
        window.toggleMenu = function() {
            const isActive = sideMenu.classList.contains('active');
            if(isActive){
                sideMenu.classList.remove('active');
                menuOverlay.classList.remove('active');
            } else {
                sideMenu.classList.add('active');
                menuOverlay.classList.add('active');
                updateFavoritesMenu();
            }
        }

        window.openModal = function(id) { document.getElementById(id).style.display = 'flex'; }
        window.closeModal = function(id) { document.getElementById(id).style.display = 'none'; }

        window.toggleFavorite = function(productName, event) {
            event.stopPropagation();
            const idx = favorites.indexOf(productName);
            if (idx === -1) favorites.push(productName); else favorites.splice(idx, 1);
            localStorage.setItem('senjedFavorites', JSON.stringify(favorites));
            
            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§
            document.querySelectorAll(`.star-btn[data-fav-name="${productName}"]`).forEach(btn => {
                btn.classList.toggle('active');
                const icon = btn.querySelector('i');
                icon.className = btn.classList.contains('active') ? 'fa-solid fa-star' : 'fa-regular fa-star';
            });
            updateFavoritesMenu();
        }

        function updateFavoritesMenu() {
            favoritesListEl.innerHTML = '';
            if (favorites.length === 0) {
                favoritesListEl.innerHTML = '<div style="color:rgba(255,255,255,0.5); font-size:0.8rem;">Ø®Ø§Ù„ÛŒ</div>';
                return;
            }
            favorites.forEach(name => {
                const div = document.createElement('div');
                div.style.cssText = "display:flex; justify-content:space-between; padding:5px 0; border-bottom:1px solid rgba(255,255,255,0.05); font-size:0.9rem;";
                div.innerHTML = `<span>${name}</span><i class="fa-solid fa-trash" style="cursor:pointer; color:#ff6b6b" onclick="toggleFavorite('${name}', event)"></i>`;
                favoritesListEl.appendChild(div);
            });
        }

        /* --- Ø¬Ø³ØªØ¬ÙˆÛŒ ØµÙˆØªÛŒ --- */
        window.startVoiceSearch = function() {
            const btn = document.getElementById('mic-btn');
            if (!('webkitSpeechRecognition' in window)) {
                alert('Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ø¬Ø³ØªØ¬ÙˆÛŒ ØµÙˆØªÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯.');
                return;
            }
            const recognition = new webkitSpeechRecognition();
            recognition.lang = 'fa-IR';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.start();
            btn.classList.add('listening');

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                searchInput.value = transcript;
                searchInput.dispatchEvent(new Event('input')); // ØªØ±ÛŒÚ¯Ø± Ú©Ø±Ø¯Ù† Ø¬Ø³ØªØ¬Ùˆ
                btn.classList.remove('listening');
            };
            recognition.onerror = function() { btn.classList.remove('listening'); };
            recognition.onend = function() { btn.classList.remove('listening'); };
        }

        /* --- Ø·Ø¨ÛŒØ¨ Ø³Ù†Ø¬Ø¯ --- */
        window.applyRemedy = function(type) {
            closeModal('remedyModal');
            let query = "";
            if(type === 'Ø³Ø±Ø¯Ø±Ø¯') query = "Ø§Ø³Ø·ÙˆØ®ÙˆØ¯ÙˆØ³"; 
            else if(type === 'Ù…Ø¹Ø¯Ù‡') query = "Ù†Ø¹Ù†Ø§";
            else if(type === 'Ø§Ø¹ØµØ§Ø¨') query = "Ú¯Ù„â€ŒÚ¯Ø§ÙˆØ²Ø¨Ø§Ù†";
            else if(type === 'Ø³Ø±Ù…Ø§Ø®ÙˆØ±Ø¯Ú¯ÛŒ') query = "Ø¢ÙˆÛŒØ´Ù†";
            
            searchInput.value = query; // ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´
            const results = allProducts.filter(p => 
                (type==='Ø³Ø±Ø¯Ø±Ø¯' && (p.name.includes('Ø§Ø³Ø·ÙˆØ®ÙˆØ¯ÙˆØ³') || p.name.includes('Ú†Ø§ÛŒ'))) ||
                (type==='Ù…Ø¹Ø¯Ù‡' && (p.name.includes('Ù†Ø¹Ù†Ø§') || p.name.includes('Ø²Ù†ÛŒØ§Ù†'))) ||
                (type==='Ø§Ø¹ØµØ§Ø¨' && (p.name.includes('Ú¯Ù„') || p.name.includes('Ø³Ù†Ø¨Ù„'))) ||
                (type==='Ø³Ø±Ù…Ø§Ø®ÙˆØ±Ø¯Ú¯ÛŒ' && (p.name.includes('Ø¢ÙˆÛŒØ´Ù†') || p.name.includes('Ù¾ÙˆÙ†Ù‡')))
            );
            if(results.length === 0) {
                 searchInput.value = type;
                 searchInput.dispatchEvent(new Event('input'));
            } else {
                showProductView(results, `Ù†Ø³Ø®Ù‡ Ø¯Ú©ØªØ± Ø³Ù†Ø¬Ø¯: ${type}`);
            }
        }

        /* --- Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³ --- */
        window.spinWheel = function() {
            const wheel = document.getElementById('luckyWheel');
            const resText = document.getElementById('winResult');
            const btn = document.getElementById('spinBtn');
            
            if(btn.disabled) return;
            btn.disabled = true;
            resText.textContent = "";
            
            const deg = Math.floor(1000 + Math.random() * 1000);
            wheel.style.transform = `rotate(${deg}deg)`;
            
            setTimeout(() => {
                const prizes = ["5% ØªØ®ÙÛŒÙ", "Ø§Ø±Ø³Ø§Ù„ Ø±Ø§ÛŒÚ¯Ø§Ù†", "Ù¾ÙˆÚ†", "10% ØªØ®ÙÛŒÙ", "Ù¾ÙˆÚ†", "Ù‡Ø¯ÛŒÙ‡ Ú©ÙˆÚ†Ú©"];
                const prize = prizes[Math.floor(Math.random()*prizes.length)];
                if(prize !== "Ù¾ÙˆÚ†") {
                    resText.textContent = `ğŸ‰ ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ Ø¨Ø±Ù†Ø¯Ù‡ Â«${prize}Â» Ø´Ø¯ÛŒØ¯!`;
                    resText.style.color = "#2ecc71";
                    activeDiscount = prize;
                } else {
                    resText.textContent = "ğŸ˜” Ù…ØªØ§Ø³ÙØ§Ù†Ù‡ Ù¾ÙˆÚ† Ø¨ÙˆØ¯.";
                    resText.style.color = "#e74c3c";
                }
                btn.disabled = false;
            }, 4000);
        }

        function showProductView(products, title) {
            categoryView.style.display='none';
            document.querySelectorAll('.inner-section').forEach(el => el.style.display='none');
            document.getElementById('product-view').style.display='block';
            
            productList.innerHTML='';
            categoryTitle.textContent=title;
            document.getElementById('loading').style.display='none';

            products.forEach(p=>{
                const li = document.createElement('li');
                li.className='product-item';
                
                let pressTimer;
                li.addEventListener('touchstart', () => { 
                    pressTimer = setTimeout(() => showInfo(p), 600); 
                });
                li.addEventListener('touchend', () => clearTimeout(pressTimer));
                li.addEventListener('contextmenu', (e) => { e.preventDefault(); showInfo(p); });

                const isSel = shoppingCart.some(i=>i.name===p.name && i.type==='standard');
                if(isSel) li.classList.add('selected');
                const isFav = favorites.includes(p.name);

                li.innerHTML = `
                    <button class="star-btn ${isFav?'active':''}" data-fav-name="${p.name}" onclick="toggleFavorite('${p.name}', event)">
                        <i class="${isFav?'fa-solid':'fa-regular'} fa-star"></i>
                    </button>
                    <input type="checkbox" class="product-checkbox" data-name="${p.name}" ${isSel?'checked':''}>
                    <label class="product-name">${p.name}</label>
                    <div class="quantity-input-container">
                        <input type="number" min="1" class="quantity-input" value="1">
                        <span style="font-size:0.8rem; color:#888;">${p.unit}</span>
                        <div class="delete-btn"><i class="fa-solid fa-trash-can"></i></div>
                    </div>
                `;
                productList.appendChild(li);
            });
            window.scrollTo(0,0);
        }
        
        function showInfo(p) {
            document.getElementById('infoTitle').textContent = p.name;
            document.getElementById('infoDesc').textContent = p.desc || "ØªÙˆØ¶ÛŒØ­Ø§Øª Ø®Ø§ØµÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª.";
            document.getElementById('infoNature').textContent = p.nature || "Ù†Ø§Ù…Ø´Ø®Øµ";
            document.getElementById('infoIcon').innerHTML = '<i class="fa-solid fa-leaf" style="color:#6B8E23"></i>';
            openModal('infoModal');
        }

        window.showCategoryView = function() {
            document.querySelectorAll('.inner-section').forEach(el => el.style.display='none');
            categoryView.style.display='block';
            window.scrollTo(0,0);
        }
        
        window.showSection = function(id) {
            categoryView.style.display='none';
            document.querySelectorAll('.inner-section').forEach(el => el.style.display='none');
            document.getElementById(id).style.display='block';
            window.scrollTo(0,0);
        }

        function updateCart() {
            const stdItems = [];
            document.querySelectorAll('.product-checkbox:checked').forEach(cb => {
                const li = cb.closest('.product-item');
                const q = li.querySelector('.quantity-input').value;
                stdItems.push({ name: cb.dataset.name, quantity: q, unit:'Ø¹Ø¯Ø¯', type:'standard' });
            });
            shoppingCart = [...stdItems, ...mixedProducts];
            
            if (shoppingCart.length > 0) {
                whatsappBtn.classList.add('visible');
                cartCounter.textContent = shoppingCart.length;
            } else {
                whatsappBtn.classList.remove('visible');
            }
        }

        productList.addEventListener('change', e => {
            if (e.target.classList.contains('product-checkbox')) {
                const li = e.target.closest('.product-item');
                if (e.target.checked) {
                    li.classList.add('selected');
                } else {
                    li.classList.remove('selected');
                }
                updateCart();
            }
        });

        productList.addEventListener('click', e => {
            if (e.target.closest('.delete-btn')) {
                if(!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù…Ø­ØµÙˆÙ„ Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) return;
                const li = e.target.closest('.product-item');
                li.querySelector('.product-checkbox').checked = false;
                li.classList.remove('selected');
                updateCart();
            }
        });

        whatsappBtn.addEventListener('click', () => {
            let msg = "Ø³Ù„Ø§Ù… ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø³Ù†Ø¬Ø¯ØŒ Ø³ÙØ§Ø±Ø´ Ù…Ù†:\n\n";
            const std = shoppingCart.filter(i=>i.type==='standard');
            if(std.length){
                msg+="ğŸ“¦ Ù…Ø­ØµÙˆÙ„Ø§Øª:\n";
                std.forEach(i=>msg+=`â–ªï¸ ${i.name}: ${i.quantity} ${i.unit}\n`);
            }
            const mix = shoppingCart.filter(i=>i.type==='mix');
            if(mix.length){
                msg+="\nğŸ§ª ØªØ±Ú©ÛŒØ¨â€ŒÙ‡Ø§ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ:\n";
                mix.forEach(i=>msg+=`â–ªï¸ ${i.name} (${i.quantity} Ø¸Ø±Ù)\n   (ÙˆØ²Ù†: ${i.weightLabel})\n   Ù…Ø­ØªÙˆÛŒØ§Øª: ${i.details}\n`);
            }
            if(activeDiscount) msg += `\nğŸ Ú©Ø¯ Ø¬Ø§ÛŒØ²Ù‡ Ù…Ù†: ${activeDiscount}`;
            window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(msg)}`, '_blank');
        });

        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            if(term.length < 2) return;
            const res = allProducts.filter(p => p.name.includes(term));
            showProductView(res, `Ù†ØªØ§ÛŒØ¬: ${term}`);
        });

        document.querySelectorAll('.category-tile[data-category]').forEach(tile => {
            tile.addEventListener('click', function() {
                const cat = this.dataset.category;
                const res = allProducts.filter(p => p.category === cat);
                showProductView(res, this.querySelector('h2').textContent);
            });
        });

        /* ========================================= */
        /* !!! Ù„Ø§Ø¬ÛŒÚ© Ù…ÛŒÚ©Ø³Ø± Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯Ù‡ !!! */
        /* ========================================= */
        let mixerConfig = { max:1000, step:100 }, currentFlaskWeight = 0, flaskIngredients = [], mixCounter = 1;
        const jarColors = ['#FF6B6B','#4ECDC4','#FFE66D','#FF9F43','#54A0FF','#5F27CD','#C4E538','#FDA7DF','#D980FA','#B53471','#009432','#F79F1F','#1B1464','#EA2027','#A3CB38','#12CBC4','#ED4C67','#B53471','#833471','#6F1E51'];
        
        window.setMixerSize = function(max,step,btn){
            if(currentFlaskWeight>0 && !confirm("Ø¨Ø§ ØªØºÛŒÛŒØ± Ø³Ø§ÛŒØ²ØŒ Ù…Ø­ØªÙˆÛŒØ§Øª ÙØ¹Ù„ÛŒ Ø¸Ø±Ù Ø®Ø§Ù„ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ù‡ÛŒØ¯ØŸ")) return;
            resetFlask();
            mixerConfig={max,step};
            document.querySelectorAll('.size-btn').forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
        }
        function resetFlask(){
            currentFlaskWeight=0; flaskIngredients=[];
            document.getElementById('flask-content').innerHTML='';
            document.getElementById('current-weight').textContent='0';
        }
        window.initMixer = function(){
            const shelf = document.getElementById('shelf');
            if(shelf.children.length>0) return;
            jarColors.forEach((color,i)=>{
                const div = document.createElement('div');
                div.className='supplement-jar';
                div.setAttribute('data-name',`Ù…Ú©Ù…Ù„ ${i+1}`);
                div.setAttribute('data-color',color);
                div.innerHTML=`<div class="jar-lid"></div><div class="jar-body" style="background:${color}"><span style="color:#fff">Ù…Ú©Ù…Ù„ ${i+1}</span></div>`;
                div.draggable=true;
                div.addEventListener('dragstart',handleDragStart);
                div.addEventListener('touchstart',handleTouchStart,{passive:false});
                div.addEventListener('touchmove',handleTouchMove,{passive:false});
                div.addEventListener('touchend',handleTouchEnd);
                shelf.appendChild(div);
            });
            const target = document.getElementById('flask-target');
            target.addEventListener('dragover',e=>e.preventDefault());
            target.addEventListener('drop',handleDrop);
        }
        let draggedData=null, ghost=document.getElementById('drag-ghost');
        function handleDragStart(){ draggedData={name:this.dataset.name,color:this.dataset.color}; }
        function handleDrop(e){ e.preventDefault(); if(draggedData) addIngredient(draggedData); }
        function handleTouchStart(e){
            e.preventDefault();
            const t=e.touches[0];
            draggedData={name:this.dataset.name,color:this.dataset.color};
            ghost.style.display='flex';
            ghost.style.background=draggedData.color;
            ghost.innerHTML='<i class="fa-solid fa-cube"></i>';
            moveGhost(t.clientX,t.clientY);
        }
        function handleTouchMove(e){ e.preventDefault(); moveGhost(e.touches[0].clientX,e.touches[0].clientY); }
        function handleTouchEnd(e){
            ghost.style.display='none';
            const t=e.changedTouches[0];
            const rect=document.getElementById('flask-target').getBoundingClientRect();
            if(t.clientX>=rect.left&&t.clientX<=rect.right&&t.clientY>=rect.top&&t.clientY<=rect.bottom){
                if(draggedData) addIngredient(draggedData);
            }
            draggedData=null;
        }
        function moveGhost(x,y){ ghost.style.left=(x-25)+'px'; ghost.style.top=(y-25)+'px'; }

        function addIngredient(item){
            if(currentFlaskWeight>=mixerConfig.max){ alert("Ø¸Ø±Ù Ù¾Ø± Ø´Ø¯Ù‡ Ø§Ø³Øª!"); return; }
            currentFlaskWeight+=mixerConfig.step;
            document.getElementById('current-weight').textContent=currentFlaskWeight;
            const layer=document.createElement('div');
            layer.className='powder-layer';
            layer.style.height=((mixerConfig.step/mixerConfig.max)*100)+'%';
            layer.style.backgroundColor=item.color;
            document.getElementById('flask-content').appendChild(layer);
            createParticles(item.color);
            flaskIngredients.push(item.name);
            if(currentFlaskWeight>=mixerConfig.max) setTimeout(finishMixing,600);
        }

        function createParticles(color){
            const flask=document.getElementById('flask-target');
            for(let i=0;i<5;i++){
                const p=document.createElement('div');
                p.className='particle';
                p.style.backgroundColor=color;
                p.style.left=(40+Math.random()*20)+'%';
                p.style.animationDuration=(0.5+Math.random()*0.5)+'s';
                flask.appendChild(p);
                setTimeout(()=>p.remove(),1000);
            }
        }

        function finishMixing(){
            const mixId=Date.now(), counts={};
            flaskIngredients.forEach(x=>counts[x]= (counts[x]||0)+1);
            const details = Object.entries(counts).map(([k,v])=>`${k} (${v*mixerConfig.step}g)`).join('ØŒ ');
            const weightLabel = mixerConfig.max>=1000?`${mixerConfig.max/1000} Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…`:`${mixerConfig.max} Ú¯Ø±Ù…`;
            const mixName = `Ù…ÛŒÚ©Ø³ Ø§Ø®ØªØµØ§ØµÛŒ ${mixCounter} (${weightLabel})`;
            const newMix = { id:mixId, name:mixName, quantity:1, unit:"Ø¹Ø¯Ø¯", weightLabel, type:"mix", details };
            mixedProducts.push(newMix);
            const list=document.getElementById('mix-list');
            if(mixCounter===1) list.innerHTML='';
            const row=document.createElement('div');
            row.className='mix-item'; row.id=`mix-row-${mixId}`;
            row.innerHTML=`
                <div>
                    <span style="font-weight:bold; display:block;">${mixName}</span>
                    <span style="font-size:0.7rem; color:#777;">${details.substring(0,30)}...</span>
                </div>
                <button class="delete-mix-btn" aria-label="Ø­Ø°Ù ØªØ±Ú©ÛŒØ¨" onclick="removeMix(${mixId})">
                    <i class="fa-solid fa-trash"></i>
                </button>
            `;
            list.appendChild(row);
            mixCounter++;
            alert(`"${mixName}" Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ Ùˆ Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ú¯Ø±Ø¯ÛŒØ¯.`);
            resetFlask();
            updateCart();
        }

        window.removeMix = function(id){
            if(!confirm("Ø§ÛŒÙ† ØªØ±Ú©ÛŒØ¨ Ø­Ø°Ù Ø´ÙˆØ¯ØŸ")) return;
            mixedProducts = mixedProducts.filter(p=>p.id!==id);
            const row=document.getElementById(`mix-row-${id}`);
            if(row) row.remove();
            if(mixedProducts.length===0){
                document.getElementById('mix-list').innerHTML = '<small style="color:#999; display:block; text-align:center;">Ù‡Ù†ÙˆØ² ØªØ±Ú©ÛŒØ¨ÛŒ Ù†Ø³Ø§Ø®ØªÙ‡â€ŒØ§ÛŒØ¯.</small>';
                mixCounter=1;
            }
            updateCart();
        }
    });
    </script>
</body>
</html>
